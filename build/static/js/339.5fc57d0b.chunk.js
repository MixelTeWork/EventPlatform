"use strict";(self.webpackChunkevent_platform=self.webpackChunkevent_platform||[]).push([[339],{2883:(e,s,t)=>{t.r(s),t.d(s,{default:()=>us});var n=t(7689),r=t(1933);class l extends Error{}async function i(e,s,t){const n=await fetch(s,{method:e,headers:{"Content-Type":"application/json"},body:void 0===t?null:JSON.stringify(t)});if(!n.ok)throw new l((await n.json()).msg);return n}function a(e,s){return i("POST",e,s)}async function o(e,s,t){const n=await i(e,s,t);return await n.json()}function c(e,s){return o("GET",e,s)}function d(e,s){return o("POST",e,s)}function u(){const e=(0,r.useQueryClient)();return()=>e.invalidateQueries("user")}function m(){return(0,r.useQuery)("user",h)}async function h(){const e=await fetch("/api/user"),s=await e.json();if(401==e.status)return{auth:!1,id:"",balance:0,roles:[],name:"",last_name:"",photo:"",complited_quests:[],operations:[]};if(!e.ok)throw new l(s.msg);const t=s;return t.auth=!0,t}function _(e,s){var t,n;return!(null===(t=e.data)||void 0===t||!t.auth||null===(n=e.data)||void 0===n||!n.operations.includes(s))}function v(e){return _(m(),e)}var x=t(5086),j=t(2791);function f(){const{pathname:e}=(0,n.TH)();return(0,j.useEffect)((()=>{window.scrollTo(0,0)}),[e]),null}var g=t(184);function p(e,s){const t=e instanceof l?e.message:"\u041e\u0448\u0438\u0431\u043a\u0430";return s?s(t):t}function y(e,s,t){if(!e.isError)return null;return(s||b)(p(e.error,t))}function b(e){return(0,g.jsx)("h3",{style:{color:"tomato",textAlign:"center"},children:e})}function A(){for(var e=arguments.length,s=new Array(e),t=0;t<e;t++)s[t]=arguments[t];return s.filter((e=>!!e)).join(" ")}const N={root:"styles_root__hzHjz",visible:"styles_visible__6aD-n",close:"styles_close__3L8iW",message:"styles_message__oF8zk"};let H="";function w(){const[e,s]=(0,j.useState)("");return(0,j.useEffect)((()=>{const e=setInterval((()=>{const e=function(e){let s=document.cookie.match(new RegExp("(?:^|; )"+e.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g,"\\$1")+"=([^;]*)"));return s?decodeURIComponent(s[1]):void 0}("MESSAGE_TO_FRONTEND");e!=H&&(H=e||"",s(H))}),1e3);return()=>{clearInterval(e)}}),[s]),(0,g.jsxs)("div",{className:A(N.root,""!=e&&N.visible),children:[(0,g.jsx)("button",{className:N.close,onClick:()=>s("")}),(0,g.jsx)("div",{className:N.message,children:k(e)})]})}function k(e){return'"'==e.at(0)&&(e=e.slice(1)),'"'==e.at(-1)&&(e=e.slice(0,-1)),e}const S={root:"styles_root__4DGhY"};function C(){const e=(0,n.s0)();return(0,g.jsx)("div",{className:S.root,children:(0,g.jsx)("button",{onClick:()=>e(-1),className:"button button_light",children:"\u041d\u0430\u0437\u0430\u0434"})})}var I=t(1087);const E={root:"styles_root__Zvl9c",home:"styles_home__o+-s7",block:"styles_block__a1SM7",balance:"styles_balance__PLLCC",user:"styles_user__0ltHf",menu:"styles_menu__WWgPh",img:"styles_img__vhWmb",menuVisible:"styles_menuVisible__mMGZn"};async function F(e){const s=await d("/api/auth",e);return s.auth=!0,s}async function Q(){await a("/api/logout")}const L={root:"styles_root__BdzzK",spinner:"styles_spinner__rlI86","lds-ring":"styles_lds-ring__jnLuB"};function P(e){let{color:s,zIndex:t,block:n,r:r=0}=e;return(0,g.jsx)("div",{className:L.root,style:{position:n?"absolute":"fixed",borderRadius:r},children:(0,g.jsxs)("div",{className:L.spinner,style:{"--color":s,zIndex:t},children:[(0,g.jsx)("div",{}),(0,g.jsx)("div",{}),(0,g.jsx)("div",{}),(0,g.jsx)("div",{})]})})}function q(){var e,s,t,l;const[i,a]=(0,j.useState)(!1),o=(0,n.s0)(),c=function(e){const s=(0,r.useQueryClient)();return(0,r.useMutation)({mutationFn:Q,onSuccess:()=>{s.setQueryData("user",(e=>({auth:!1,id:"",balance:0,roles:[],name:"",last_name:"",photo:"",complited_quests:[],operations:[]}))),null===e||void 0===e||e()}})}((()=>{a(!1)})),d=m();return(0,g.jsxs)("div",{className:E.root,children:[(0,g.jsx)(I.rU,{to:"/",className:A(E.home,"material_symbols"),children:"home"}),(0,g.jsxs)("span",{className:E.block,children:[(0,g.jsxs)("div",{className:E.balance,children:[(null===(e=d.data)||void 0===e?void 0:e.balance)||0," G"]}),(0,g.jsx)("button",{className:E.user,onClick:()=>{var e;return null!==(e=d.data)&&void 0!==e&&e.auth?a((e=>!e)):o("/login")},children:(0,g.jsx)("span",{children:null!==(s=d.data)&&void 0!==s&&s.auth?null===(t=d.data)||void 0===t?void 0:t.name:"\u0412\u043e\u0439\u0442\u0438"})}),(null===(l=d.data)||void 0===l?void 0:l.photo)&&(0,g.jsx)("img",{className:E.img,src:d.data.photo,alt:"avatar"}),(0,g.jsxs)("div",{className:A(E.menu,i&&E.menuVisible),children:[(0,g.jsx)("button",{onClick:()=>o("/profile"),children:"\u041f\u0440\u043e\u0444\u0438\u043b\u044c"}),_(d,"page_debug")&&(0,g.jsx)(I.rU,{to:"/debug",children:"</>"}),_(d,"page_worker")&&(0,g.jsx)(I.rU,{to:"/worker",className:"material_symbols",children:"deployed_code"}),(0,g.jsx)("button",{onClick:()=>c.mutate(),disabled:"idle"!=c.status,children:"\u0412\u044b\u0439\u0442\u0438"})]})]}),"loading"==c.status&&(0,g.jsx)(P,{})]})}const M={root:"styles_root__xvR2N",hasFooter:"styles_hasFooter__lMS3o",body:"styles_body__S-p4X",body_centered:"styles_body_centered__NzRPU",body_centeredPage:"styles_body_centeredPage__R-EzO"};function T(e){let{children:s,className:t,styles:n,centered:r=!1,centeredPage:l=!1,height100:i=!1,gap:a=0,header:o,footer:c}=e;return void 0===o&&(o=(0,g.jsx)(q,{})),(0,g.jsxs)("div",{className:A(M.root,!!c&&M.hasFooter),style:{...n,maxHeight:i?"100dvh":""},children:[o||(0,g.jsx)("div",{}),(0,g.jsx)("div",{className:A(M.body,t,r&&M.body_centered,l&&M.body_centeredPage),style:{gap:a,maxHeight:i?"100%":""},children:s}),c]})}function U(){return(0,g.jsx)(T,{centered:!0,header:(0,g.jsx)(C,{}),children:"\u0422\u0430\u043a\u043e\u0439 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u044b \u043d\u0435\u0442"})}function D(){return(0,g.jsx)(T,{centered:!0,header:(0,g.jsx)(C,{}),children:"\u0423 \u0432\u0430\u0441 \u043d\u0435\u0434\u043e\u0441\u0442\u0430\u0442\u0442\u043e\u0447\u043d\u043e \u043f\u0440\u0430\u0432 \u043d\u0430 \u043f\u0440\u043e\u0441\u043c\u043e\u0442\u0440 \u044d\u0442\u043e\u0439 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u044b"})}const O={back:"styles_back__uuJZO",form:"styles_form__n7Rcu"};function R(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"\u041c\u0435\u0440\u043e\u043f\u0440\u0438\u044f\u0442\u0438\u0435";(0,j.useEffect)((()=>{const t=document.title,n="object"!=typeof e?[e]:e;return document.title=[s,...n].filter((e=>!!e)).join(" | "),()=>{document.title=t}}),[e,s])}const z={form:"styles_form__cFFCH",field:"styles_field__5rpBk"};function B(e){let{className:s,style:t,onSubmit:n,children:r}=e;return(0,g.jsx)("form",{className:A(z.form,s),style:t,onSubmit:e=>{e.preventDefault(),n()},children:r})}function W(e){let{label:s,className:t,style:n,children:r}=e;return(0,g.jsxs)("label",{className:A(z.field,t),style:n,children:[(0,g.jsx)("span",{children:s}),r]})}function Y(){R("\u0410\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0438\u044f");const[e,s]=(0,j.useState)(""),t=(0,j.useRef)(null),n=(0,j.useRef)(null),i=function(e){const s=(0,r.useQueryClient)(),t=(0,r.useMutation)({mutationFn:F,onSuccess:e=>{s.setQueryData("user",(()=>e))},onError:s=>{null===e||void 0===e||e(s instanceof l?s.message:"\u041f\u0440\u043e\u0438\u0437\u043e\u0448\u043b\u0430 \u043e\u0448\u0438\u0431\u043a\u0430, \u043f\u043e\u043f\u0440\u043e\u0431\u0443\u0439\u0442\u0435 \u0435\u0449\u0451 \u0440\u0430\u0437")}});return t}(s);return(0,g.jsxs)(T,{header:null,centered:!0,centeredPage:!0,gap:"2em",children:[(0,g.jsx)(I.rU,{to:"/",className:A(O.back,"material_symbols"),children:"arrow_back"}),(0,g.jsx)("h1",{children:"\u041c\u0435\u0440\u043e\u043f\u0440\u0438\u044f\u0442\u0438\u0435"}),e&&(0,g.jsx)("h3",{children:e}),i.isLoading&&(0,g.jsx)(P,{}),(0,g.jsxs)(B,{className:O.form,onSubmit:function(){var e,s;const r=(null===(e=t.current)||void 0===e?void 0:e.value)||"",l=(null===(s=n.current)||void 0===s?void 0:s.value)||"";i.mutate({login:r,password:l})},children:[(0,g.jsx)(W,{label:"\u041b\u043e\u0433\u0438\u043d",children:(0,g.jsx)("input",{ref:t,type:"text",name:"login",required:!0})}),(0,g.jsx)(W,{label:"\u041f\u0430\u0440\u043e\u043b\u044c",children:(0,g.jsx)("input",{ref:n,type:"password",name:"password",required:!0})}),(0,g.jsx)("button",{type:"submit",className:"button button_light button_small",disabled:"loading"==i.status,children:"\u0412\u043e\u0439\u0442\u0438"})]})]})}const G={root:"styles_root__h8xNs",title:"styles_title__+su+v",map:"styles_map__giu5H"},X=t.p+"static/media/map.b7c468d134662b591994.png",J={root:"styles_root__cV7H9"};function K(e){let{curPage:s}=e;return(0,g.jsxs)("div",{className:J.root,children:["map"!=s&&(0,g.jsx)(I.rU,{to:"/",children:"\u041a\u0430\u0440\u0442\u0430"}),"timetable"!=s&&(0,g.jsx)(I.rU,{to:"/timetable",children:"\u0420\u0430\u0441\u043f\u0438\u0441\u0430\u043d\u0438\u0435"}),"quest"!=s&&(0,g.jsx)(I.rU,{to:"/quest",children:"\u041a\u0432\u0435\u0441\u0442\u044b"}),"store"!=s&&(0,g.jsx)(I.rU,{to:"/store",children:"\u041c\u0430\u0433\u0430\u0437\u0438\u043d"})]})}function V(){return(0,g.jsxs)(T,{centeredPage:!0,gap:"1em",className:G.root,footer:(0,g.jsx)(K,{curPage:"map"}),children:[(0,g.jsx)("h1",{className:G.title,children:"Underparty"}),(0,g.jsx)("div",{className:G.map,children:(0,g.jsx)("img",{src:X,alt:"\u041a\u0430\u0440\u0442\u0430"})})]})}const Z={root:"styles_root__7P05R"},$={root:"styles_root__O0923",hidden:"styles_hidden__eYJaf",open:"styles_open__35Vcu",popup:"styles_popup__L-0H0",header:"styles_header__o87wG",close:"styles_close__w0Yhz",body:"styles_body__t75Nd"};function ee(e){let{children:s,open:t=!1,close:n,title:r="",closeOnOutclick:l=!0}=e;const i=(0,j.useRef)(null),[a,o]=(0,j.useState)(t),[c,d]=(0,j.useState)(!t);return(0,j.useEffect)((()=>{if(t){d(!1);const e=setTimeout((()=>o(!0)),100);return()=>clearTimeout(e)}o(!1);const e=setTimeout((()=>d(!0)),250);return()=>clearTimeout(e)}),[t]),(0,g.jsx)("div",{ref:i,className:A($.root,a&&$.open,c&&$.hidden),onClick:e=>{l&&e.target==i.current&&(null===n||void 0===n||n())},children:(0,g.jsxs)("div",{className:$.popup,children:[(r||n)&&(0,g.jsxs)("div",{className:$.header,children:[(0,g.jsx)("h3",{children:r}),n&&(0,g.jsx)("button",{className:$.close,onClick:n})]}),(0,g.jsx)("div",{className:$.body,children:s})]})})}function se(){const[e,s]=(0,j.useState)(""),[t,n]=(0,j.useState)(""),r=(0,j.useRef)(null),l=(0,j.useRef)(null);return(0,g.jsxs)(T,{centered:!0,gap:"1rem",className:Z.root,children:[(0,g.jsx)(I.rU,{to:"/users",children:"Users"}),(0,g.jsx)(I.rU,{to:"/log",children:"Log"}),(0,g.jsx)("button",{onClick:async()=>{s("Loading");try{const e=await fetch("/api/debug/log_errors"),t=await e.text();s(t),setTimeout((()=>{var e,s,t,n;return null===(e=r.current)||void 0===e||null===(s=e.parentElement)||void 0===s?void 0:s.scrollTo(0,null===(t=r.current)||void 0===t||null===(n=t.parentElement)||void 0===n?void 0:n.scrollHeight)}),150)}catch(e){s(JSON.stringify(e))}},children:"Log errors"}),(0,g.jsx)("button",{onClick:async()=>{n("Loading");try{const e=await fetch("/api/debug/log_info"),s=await e.text();n(s),setTimeout((()=>{var e,s,t,n;return null===(e=l.current)||void 0===e||null===(s=e.parentElement)||void 0===s?void 0:s.scrollTo(0,null===(t=l.current)||void 0===t||null===(n=t.parentElement)||void 0===n?void 0:n.scrollHeight)}),150)}catch(e){n(JSON.stringify(e))}},children:"Log requests"}),(0,g.jsx)(ee,{title:"logErrors",open:""!=e,close:()=>s(""),children:(0,g.jsx)("pre",{ref:r,children:e})}),(0,g.jsx)(ee,{title:"log",open:""!=t,close:()=>n(""),children:(0,g.jsx)("pre",{ref:l,children:t})})]})}const te={user:"styles_user__WUZvf",title:"styles_title__Gd1jL",toggle:"styles_toggle__qlIwC",toggleInp:"styles_toggleInp__fGE-7",userInfo:"styles_userInfo__vgBlw",operations:"styles_operations__MGBbv"};function ne(){var e;R("\u041f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0438");const s=(0,r.useQuery)("users",(async()=>await c("/api/users")));return(0,g.jsxs)(T,{centeredPage:!0,gap:8,styles:{fontFamily:"'PT Sans', Arial"},children:[s.isLoading&&(0,g.jsx)("h3",{children:"\u0417\u0430\u0433\u0440\u0443\u0437\u043a\u0430"}),y(s),null===(e=s.data)||void 0===e?void 0:e.map((e=>(0,g.jsxs)("div",{className:te.user,children:[(0,g.jsx)("input",{type:"checkbox",className:te.toggleInp,id:"user".concat(e.id)}),(0,g.jsxs)("label",{className:te.title,htmlFor:"user".concat(e.id),children:[(0,g.jsxs)("div",{children:[(0,g.jsx)("div",{children:e.login}),(0,g.jsx)("div",{style:{color:"blue"},children:e.id}),(0,g.jsx)("div",{children:"|"}),(0,g.jsx)("div",{children:e.name})]}),(0,g.jsxs)("div",{children:[e.deleted&&(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)("div",{style:{color:"tomato"},children:"deleted"}),(0,g.jsx)("div",{children:"|"})]}),(0,g.jsx)("span",{children:e.roles.join(", ")}),(0,g.jsx)("div",{className:te.toggle})]})]}),(0,g.jsx)("div",{className:te.userInfo,children:(0,g.jsxs)("div",{children:[(0,g.jsx)("h4",{children:"Operations"}),(0,g.jsx)("div",{className:te.operations,children:e.operations.map(((e,s)=>(0,g.jsx)("div",{children:re(e)},s)))})]})})]},e.id)))]})}function re(e){const s={page:"#990099",add:"#008000",get:"#008000",change:"#006fb3",delete:"#b30000"};for(const t in s)if(e.startsWith(t))return(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)("span",{style:{color:s[t]},children:t}),(0,g.jsx)("span",{children:e.slice(t.length)})]});return(0,g.jsx)("span",{children:e})}function le(e){const s=e;return s.date=new Date(e.date),s}function ie(e,s){return"".concat(e).padStart(s,"0")}function ae(e){let s=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return function(e){return e?arguments.length>1&&void 0!==arguments[1]&&arguments[1]?"".concat(e.getFullYear(),".").concat(ie(e.getMonth()+1,2),".").concat(ie(e.getDate(),2)):"".concat(ie(e.getDate(),2),".").concat(ie(e.getMonth()+1,2),".").concat(e.getFullYear()):""}(e,arguments.length>2&&void 0!==arguments[2]&&arguments[2])+" "+function(e){let s=arguments.length>1&&void 0!==arguments[1]&&arguments[1],t="".concat(ie(e.getHours(),2),":").concat(ie(e.getMinutes(),2));return s?t+":".concat(ie(e.getSeconds(),2)):t}(e,s)}const oe={table:"styles_table__QLr-h",changesCell:"styles_changesCell__0wQDJ",changes:"styles_changes__EyS9f",btn:"styles_btn__H7b72"};function ce(){var e;R("Log");const s=(0,r.useQuery)("log",(async()=>(await c("/api/debug/log")).map(le)));return(0,g.jsxs)(T,{centeredPage:!0,styles:{fontFamily:"'PT Sans', Arial"},children:[s.isFetching&&(0,g.jsx)("h3",{children:"\u0417\u0430\u0433\u0440\u0443\u0437\u043a\u0430"}),y(s),!s.isFetching&&(0,g.jsx)("button",{className:oe.btn,onClick:()=>s.refetch(),children:"Update"}),(0,g.jsxs)("table",{className:oe.table,children:[(0,g.jsx)("thead",{children:(0,g.jsxs)("tr",{children:[(0,g.jsx)("th",{style:{minWidth:"9.5em"},children:"Date"}),(0,g.jsx)("th",{style:{minWidth:"4em"},children:"Action"}),(0,g.jsx)("th",{style:{minWidth:"9.5em"},children:"Table[id]"}),(0,g.jsx)("th",{children:"User[id]"}),(0,g.jsx)("th",{style:{width:"18em"},children:"Changes"})]})}),(0,g.jsx)("tbody",{children:null===(e=s.data)||void 0===e?void 0:e.map((e=>(0,g.jsxs)("tr",{children:[(0,g.jsx)("td",{children:ae(e.date,!0,!0)}),(0,g.jsx)("td",{children:de(e.actionCode)}),(0,g.jsxs)("td",{children:[e.tableName,"[",e.recordId,"]"]}),(0,g.jsxs)("td",{children:[e.userName," [",e.userId,"]"]}),(0,g.jsx)("td",{className:oe.changesCell,children:(0,g.jsxs)("div",{className:oe.changes,children:[(0,g.jsx)("input",{type:"checkbox",className:oe.toggleInp,id:"item".concat(e.id)}),(0,g.jsx)("div",{children:e.changes.map((e=>(0,g.jsxs)("div",{children:[e[0],": ",JSON.stringify(e[1])," ","->"," ",JSON.stringify(e[2])]},e[0])))}),e.changes.length>0&&(0,g.jsx)("label",{className:oe.btn,htmlFor:"item".concat(e.id),children:e.changes.length})]})})]},e.id)))})]})]})}function de(e){return(0,g.jsx)("span",{style:{color:{added:"#008000",deleted:"#b30000",updated:"#006fb3",restored:"#990099"}[e]},children:e})}const ue={back:"styles_back__Qx6+G",auth:"styles_auth__p4qSS",login:"styles_login__HG64A"},me="data:image/png;base64,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";function he(){return R("\u0410\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0438\u044f"),(0,g.jsxs)(T,{header:null,centered:!0,centeredPage:!0,gap:"2em",children:[(0,g.jsx)(I.rU,{to:"/",className:A(ue.back,"material_symbols"),children:"arrow_back"}),(0,g.jsx)(I.rU,{to:"/auth",className:ue.auth}),(0,g.jsx)("h1",{children:"Underparty"}),(0,g.jsxs)("a",{className:ue.login,href:"https://oauth.vk.com/authorize?client_id=51848582&redirect_uri=https://platformevent.pythonanywhere.com/auth_vk&display=page&response_type=code",children:[(0,g.jsx)("span",{children:"\u0412\u043e\u0439\u0442\u0438 \u0447\u0435\u0440\u0435\u0437"}),(0,g.jsx)("img",{src:me,alt:"VK"})]})]})}const _e={root:"styles_root__Rm-tG",input:"styles_input__2tNlg",password:"styles_password__Om-1z",img:"styles_img__SrXRK"};function ve(){var e,s,t,n;const l=m(),i=(0,j.useRef)(null),[o,c]=(0,j.useState)(!1),d=function(e){const s=(0,r.useQueryClient)();return(0,r.useMutation)({mutationFn:async e=>(await a("/api/user/change_name",e),e),onSuccess:t=>{var n;"success"==(null===(n=s.getQueryState("user"))||void 0===n?void 0:n.status)&&s.setQueryData("user",(e=>({...e,name:t.name}))),null===e||void 0===e||e()}})}();return(0,g.jsx)(T,{centered:!0,gap:"1rem",children:(0,g.jsxs)("div",{className:_e.root,children:[y(d),d.isLoading&&(0,g.jsx)(P,{}),(0,g.jsxs)("div",{children:[(0,g.jsx)("img",{className:_e.img,src:null===(e=l.data)||void 0===e?void 0:e.photo,alt:"avatar"}),(0,g.jsx)("h3",{children:"\u0418\u043c\u044f"}),(0,g.jsx)("div",{children:(0,g.jsx)("input",{type:"text",ref:i,defaultValue:null===(s=l.data)||void 0===s?void 0:s.name,disabled:!o,className:_e.input})}),(0,g.jsxs)("div",{children:[!o&&(0,g.jsx)("button",{onClick:()=>c(!0),className:"button button_small",children:"\u0418\u0437\u043c\u0435\u043d\u0438\u0442\u044c"}),o&&(0,g.jsx)("button",{onClick:()=>{var e;c(!1),i.current&&(i.current.value=(null===(e=l.data)||void 0===e?void 0:e.name)||"")},className:"button button_small",children:"\u041e\u0442\u043c\u0435\u043d\u0430"}),o&&(0,g.jsx)("button",{onClick:()=>{c(!1),i.current&&d.mutate({name:i.current.value})},className:"button button_small",children:"\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c"})]})]}),(0,g.jsxs)("div",{children:[(0,g.jsx)("h3",{children:"\u0424\u0430\u043c\u0438\u043b\u0438\u044f"}),null===(t=l.data)||void 0===t?void 0:t.last_name]}),(0,g.jsxs)("div",{children:[(0,g.jsx)("h3",{children:"\u0420\u043e\u043b\u0438"}),null===(n=l.data)||void 0===n?void 0:n.roles.map(((e,s)=>(0,g.jsx)("div",{children:e},s)))]})]})})}const xe={root:"styles_root__E5y+5",title:"styles_title__3QqY9",map:"styles_map__bsZaz"},je=t.p+"static/media/timetable.9dbcb4664b2137d4198b.png";function fe(){return(0,g.jsxs)(T,{centeredPage:!0,gap:"1em",className:xe.root,footer:(0,g.jsx)(K,{curPage:"timetable"}),children:[(0,g.jsx)("h1",{className:xe.title,children:"Underparty"}),(0,g.jsx)("div",{className:xe.map,children:(0,g.jsx)("img",{src:je,alt:"\u0420\u0430\u0441\u043f\u0438\u0441\u0430\u043d\u0438\u0435"})})]})}function ge(){return(0,r.useQuery)("quests",(async()=>await c("/api/quests")))}function pe(e,s){return(0,r.useMutation)({mutationFn:async e=>await d("/api/quest_complete",e),onSuccess:e,onError:s})}const ye={root:"styles_root__CEdGL",body:"styles_body__o-6ZK",bottom:"styles_bottom__zkZn6",title:"styles_title__6wHPv",btnQr:"styles_btnQr__94tox",quests:"styles_quests__58NxQ",quest:"styles_quest__65tbN"};var be=t(741);function Ae(e){let{code:s,scale:t=10,margin:n=1,color:r="#000000",colorBg:l="#ffffff"}=e;const[i,a]=(0,j.useState)("");return(0,j.useEffect)((()=>{s&&(a(""),be.toDataURL(s,{errorCorrectionLevel:"H",scale:t,margin:n,color:{dark:r,light:l}},((e,s)=>a(s))))}),[s,r,t,n,l]),(0,g.jsx)("img",{src:i,alt:s,style:{width:"100%"}})}function Ne(){var e,s;const t=m(),n=u(),[r,l]=(0,j.useState)(!1),i=ge();return(0,g.jsxs)(T,{centeredPage:!0,gap:"1em",className:ye.root,footer:(0,g.jsx)(K,{curPage:"quest"}),children:[i.isLoading&&(0,g.jsx)(P,{}),t.isFetching&&(0,g.jsx)(P,{}),(0,g.jsxs)("div",{className:ye.body,children:[(0,g.jsx)("h1",{className:ye.title,children:"Underparty"}),(0,g.jsxs)("div",{className:ye.quests,children:[y(i),null===i||void 0===i||null===(e=i.data)||void 0===e?void 0:e.map((e=>{var s;return(0,g.jsxs)("div",{className:ye.quest,children:[(0,g.jsx)("span",{children:e.name}),null!==(s=t.data)&&void 0!==s&&s.complited_quests.includes(e.id)?(0,g.jsx)("span",{className:"material_symbols",children:"done"}):(0,g.jsxs)("span",{children:[e.reward,"G"]})]},e.id)}))]})]}),(0,g.jsx)("div",{className:ye.bottom,children:(0,g.jsx)("button",{className:ye.btnQr,onClick:()=>l(!0),children:"\u0417\u0430\u0432\u0435\u0440\u0448\u0438\u0442\u044c \u043a\u0432\u0435\u0441\u0442!"})}),(0,g.jsx)(ee,{title:"\u0417\u0430\u0432\u0435\u0440\u0448\u0435\u043d\u0438\u0435 \u043a\u0432\u0435\u0441\u0442\u0430",open:r,close:()=>{var e;l(!1),null!==(e=t.data)&&void 0!==e&&e.auth&&n()},children:null!==t&&void 0!==t&&null!==(s=t.data)&&void 0!==s&&s.auth?(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)(Ae,{code:"user_".concat(t.data.id),colorBg:"#ffffff00",scale:13}),(0,g.jsx)("h3",{children:"\u041f\u043e\u043a\u0430\u0436\u0438\u0442\u0435 qr-\u043a\u043e\u0434 \u043a\u0432\u0435\u0441\u0442\u043e\u0432\u0438\u043a\u0443"})]}):(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)("p",{children:"\u0414\u043b\u044f \u043f\u0440\u043e\u0445\u043e\u0436\u0434\u0435\u043d\u0438\u044f \u043a\u0432\u0435\u0441\u0442\u043e\u0432 \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e \u0432\u043e\u0439\u0442\u0438 \u0432 \u0441\u0438\u0441\u0442\u0435\u043c\u0443."}),(0,g.jsx)("p",{children:"\u041a\u043d\u043e\u043f\u043a\u0430 \u0432\u0445\u043e\u0434\u0430 \u043d\u0430\u0445\u043e\u0434\u0438\u0442\u044c\u0441\u044f \u0432 \u043f\u0440\u0430\u0432\u043e\u043c \u0432\u0435\u0440\u0445\u043d\u0435\u043c \u0443\u0433\u043b\u0443."})]})})]})}function He(){return(0,r.useQuery)("storeItems",(async()=>await c("/api/store_items")))}function we(e,s){return(0,r.useMutation)({mutationFn:async e=>await d("/api/store_sell_check",e),onSuccess:(s,t)=>{s.itemId=t.itemId,s.visitorId=t.userId,null===e||void 0===e||e(s)},onError:s})}function ke(e,s,t){const n=(0,r.useQueryClient)();return(0,r.useMutation)({mutationFn:async()=>await d("/api/store_item/".concat(e,"/decrease")),onSuccess:e=>{var t;"success"==(null===(t=n.getQueryState("storeItems"))||void 0===t?void 0:t.status)&&n.setQueryData("storeItems",(s=>(null===s||void 0===s?void 0:s.map((s=>s.id==e.id?e:s)))||[])),null===s||void 0===s||s(e)},onError:t})}function Se(e,s,t){const n=(0,r.useQueryClient)();return(0,r.useMutation)({mutationFn:async()=>{return await(s="/api/store_item/".concat(e),i("DELETE",s,t));var s,t},onSuccess:()=>{var t;"success"==(null===(t=n.getQueryState("storeItems"))||void 0===t?void 0:t.status)&&n.setQueryData("storeItems",(s=>(null===s||void 0===s?void 0:s.filter((s=>s.id!=e)))||[])),null===s||void 0===s||s()},onError:t})}const Ce={root:"styles_root__0CejE",title:"styles_title__u3Xt9",items:"styles_items__n-Fvc",item:"styles_item__zIxt2",item__img:"styles_item__img__r3iEr",item__desc:"styles_item__desc__wbcAM"};function Ie(){var e,s,t;const n=m(),r=u(),[l,i]=(0,j.useState)(!1),[a,o]=(0,j.useState)(null),c=He();return(0,g.jsxs)(T,{centeredPage:!0,gap:"1em",className:Ce.root,footer:(0,g.jsx)(K,{curPage:"store"}),children:[c.isLoading&&(0,g.jsx)(P,{}),(0,g.jsx)("h1",{className:Ce.title,children:"Underparty"}),(0,g.jsxs)("div",{className:Ce.items,children:[y(c),null===c||void 0===c||null===(e=c.data)||void 0===e?void 0:e.map((e=>(0,g.jsxs)("button",{className:Ce.item,onClick:()=>{o(e),i(!0)},children:[(0,g.jsx)("div",{className:Ce.item__img,children:e.img?(0,g.jsx)("img",{src:e.img,alt:"\u0422\u043e\u0432\u0430\u0440"}):(0,g.jsx)("div",{})}),(0,g.jsxs)("div",{className:Ce.item__desc,children:[(0,g.jsx)("span",{children:e.name}),(0,g.jsxs)("span",{children:[e.price," G"]})]})]},e.id)))]}),(0,g.jsx)(ee,{title:"\u041f\u043e\u043a\u0443\u043f\u043a\u0430 \u0442\u043e\u0432\u0430\u0440\u0430",open:l,close:()=>{var e;i(!1),null===(e=n.data)||void 0===e||!e.auth||n.data.balance<((null===a||void 0===a?void 0:a.price)||0)||r()},children:null!==n&&void 0!==n&&null!==(s=n.data)&&void 0!==s&&s.auth?(0,g.jsx)(g.Fragment,{children:n.data.balance<((null===a||void 0===a?void 0:a.price)||0)?(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)("h2",{style:{marginBottom:8},children:"\u041a \u0441\u043e\u0436\u0430\u043b\u0435\u043d\u0438\u044e, \u044d\u0442\u043e\u0442 \u0442\u043e\u0432\u0430\u0440 \u0432\u0430\u043c \u043d\u0435 \u043f\u043e \u043a\u0430\u0440\u043c\u0430\u043d\u0443"}),(0,g.jsxs)("h2",{className:Ce.item__desc,children:[(0,g.jsx)("span",{children:null===a||void 0===a?void 0:a.name}),(0,g.jsxs)("span",{children:[null===a||void 0===a?void 0:a.price," G"]})]}),(0,g.jsxs)("h2",{className:Ce.item__desc,style:{marginBottom:8},children:[(0,g.jsx)("span",{children:"\u0412\u0430\u043c \u043d\u0435 \u0445\u0432\u0430\u0442\u0430\u0435\u0442:"}),(0,g.jsxs)("span",{children:[((null===a||void 0===a?void 0:a.price)||0)-n.data.balance," G"]})]}),(0,g.jsx)("h3",{children:"\u0412\u044b\u043f\u043e\u043b\u043d\u044f\u0439\u0442\u0435 \u043a\u0432\u0435\u0441\u0442\u044b \u0438 \u0440\u0430\u0437\u0431\u043e\u0433\u0430\u0442\u0435\u0435\u0442\u0435!"})]}):(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)(Ae,{code:"user_".concat(null===(t=n.data)||void 0===t?void 0:t.id,";item_").concat(null===a||void 0===a?void 0:a.id),colorBg:"#ffffff00",scale:13}),(0,g.jsxs)("h2",{className:Ce.item__desc,children:[(0,g.jsx)("span",{children:null===a||void 0===a?void 0:a.name}),(0,g.jsxs)("span",{children:[null===a||void 0===a?void 0:a.price," G"]})]}),(0,g.jsx)("h3",{children:"\u041f\u043e\u043a\u0430\u0436\u0438\u0442\u0435 qr-\u043a\u043e\u0434 \u043f\u0440\u043e\u0434\u0430\u0432\u0446\u0443"}),(0,g.jsx)("h4",{children:"\u0415\u0441\u043b\u0438 \u0431\u0430\u043b\u0430\u043d\u0441 \u043d\u0435 \u043e\u0431\u043d\u043e\u0432\u0438\u043b\u0441\u044f \u0447\u0435\u0440\u0435\u0437 \u043f\u0430\u0440\u0443 \u0441\u0435\u043a\u0443\u043d\u0434 - \u043f\u0435\u0440\u0435\u0437\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u0435 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u0443"})]})}):(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)("p",{children:"\u0414\u043b\u044f \u0441\u043e\u0432\u0435\u0440\u0448\u0435\u043d\u0438\u044f \u043f\u043e\u043a\u0443\u043f\u043e\u043a \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e \u0432\u043e\u0439\u0442\u0438 \u0432 \u0441\u0438\u0441\u0442\u0435\u043c\u0443."}),(0,g.jsx)("p",{children:"\u041a\u043d\u043e\u043f\u043a\u0430 \u0432\u0445\u043e\u0434\u0430 \u043d\u0430\u0445\u043e\u0434\u0438\u0442\u044c\u0441\u044f \u0432 \u043f\u0440\u0430\u0432\u043e\u043c \u0432\u0435\u0440\u0445\u043d\u0435\u043c \u0443\u0433\u043b\u0443."})]})})]})}const Ee={root:"styles_root__91Sa8",title:"styles_title__Duk4+"},Fe={root:"styles_root__QdJnV",msg:"styles_msg__plnAU",msg_visible:"styles_msg_visible__G0rDm",msg_dimmed:"styles_msg_dimmed__0Xs60",bar:"styles_bar__VuYbs",bar_full:"styles_bar_full__poY0b"},Qe={error:"styles_error__EtK3I",video:"styles_video__b88Zl"},Le=t.p+"static/media/beep.38f199e084efe5461ffd.mp3";var Pe=t(1096);let qe=e=>{},Me=()=>{},Te=!1,Ue=null,De=null;function Oe(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500;if(!De){Ue=document.createElement("div"),document.body.appendChild(Ue),Ue.style.display="flex",Ue.style.backgroundColor="black";const e=document.createElement("video");Ue.appendChild(e),De=new Pe.Z(e,(e=>qe(e.data)),{highlightScanRegion:!0,maxScansPerSecond:10})}(0,j.useEffect)((()=>(setTimeout((()=>{var e;return null===(e=De)||void 0===e?void 0:e.start().catch((()=>{setTimeout((()=>{var e;null===(e=De)||void 0===e||e.start().catch((()=>Me()))}),250)}))}),100),()=>{var e;null===(e=De)||void 0===e||e.stop()})),[]);const[t,n]=(0,j.useState)(!1),[r,l]=(0,j.useState)(""),[i,a]=(0,j.useState)(Te),o=function(e){const[s]=(0,j.useState)((()=>{const s=new Audio(e);return s.preload="auto",s}));return()=>{s.currentTime=0,s.play()}}(Le);return qe=r=>{t||e||(l(r),n(!0),o(),setTimeout((()=>{l(""),n(!1)}),s))},Me=()=>{Te=!0,a(!0)},i?{scanned:r,scanner:(0,g.jsxs)("div",{className:Qe.error,children:[(0,g.jsx)("h1",{children:"\u041d\u0435\u0442 \u0434\u043e\u0441\u0442\u0443\u043f\u0430 \u043a \u043a\u0430\u043c\u0435\u0440\u0435"}),(0,g.jsx)("p",{children:"\u0420\u0430\u0437\u0440\u0435\u0448\u0438\u0442\u0435 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u0435 \u043a\u0430\u043c\u0435\u0440\u044b \u044d\u0442\u043e\u043c\u0443 \u0441\u0430\u0439\u0442\u0443 \u0438 \u0431\u0440\u0430\u0443\u0437\u0435\u0440\u0443, \u043a\u043e\u0442\u043e\u0440\u044b\u0439 \u0432\u044b \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0442\u0435."}),(0,g.jsx)("p",{children:"\u041f\u043e\u0441\u043b\u0435 \u043f\u0435\u0440\u0435\u0437\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u0435 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u0443."})]})}:{scanned:r,scanner:(0,g.jsx)("div",{children:(0,g.jsx)("div",{ref:e=>{e&&(e.innerHTML="",e.appendChild(Ue))},className:Qe.video})})}}function Re(e){let{useMutation:s,onScan:t,formatMsg:n,onRes:r,className:l,pause:i}=e;const[a,o]=(0,j.useState)(""),[c,d]=(0,j.useState)(""),u=(0,j.useRef)(null),m=s((e=>{o(n(e)),d(""),v(),null===r||void 0===r||r(e)}),(e=>{o(""),d(p(e)),v()})),{scanned:h,scanner:_}=Oe(!m.isIdle||i);function v(){var e;setTimeout((()=>m.reset()),1e3),null===(e=u.current)||void 0===e||e.classList.add(Fe.bar_full),setTimeout((()=>{var e;return null===(e=u.current)||void 0===e?void 0:e.classList.remove(Fe.bar_full)}),100)}return(0,j.useEffect)((()=>{if(""==h||!m.isIdle)return;o(""),d("");const e=t(h);e?m.mutate(e):d("\u041d\u0435 \u043e\u043f\u043e\u0437\u043d\u0430\u043d\u043e")}),[h]),(0,g.jsxs)("div",{className:A(Fe.root,l),children:[m.isLoading&&(0,g.jsx)(P,{}),_,(0,g.jsxs)("div",{className:A(Fe.msg,(a||c)&&Fe.msg_visible,(a||c)&&m.isIdle&&Fe.msg_dimmed),children:[(0,g.jsx)("h2",{children:a}),(0,g.jsx)("h2",{children:c})]}),(0,g.jsx)("div",{ref:u,className:Fe.bar})]})}function ze(){var e,s;const t=(0,n.UO)(),r=parseInt(t.questId,10),l=ge();return(0,g.jsxs)(T,{className:Ee.root,children:[l.isLoading&&(0,g.jsx)(P,{}),(0,g.jsxs)("div",{className:Ee.title,children:[(0,g.jsx)("h2",{children:null===(e=l.data)||void 0===e||null===(s=e.find((e=>e.id==r)))||void 0===s?void 0:s.name}),(0,g.jsx)("h3",{children:"\u041f\u0440\u043e\u0441\u043a\u0430\u043d\u0438\u0440\u0443\u0439\u0442\u0435 qr-\u043a\u043e\u0434 \u043f\u043e\u0441\u0435\u0442\u0438\u0442\u0435\u043b\u044f, \u0447\u0442\u043e\u0431\u044b \u0437\u0430\u0441\u0447\u0438\u0442\u0430\u0442\u044c \u0435\u043c\u0443 \u044d\u0442\u043e\u0442 \u043a\u0432\u0435\u0441\u0442."}),y(l)]}),(0,g.jsx)(Re,{useMutation:pe,onScan:e=>{if(!e.startsWith("user_"))return null;return{userId:e.slice(5),questId:r}},formatMsg:e=>({ok:"\u041a\u0432\u0435\u0441\u0442 \u0437\u0430\u0447\u0442\u0451\u043d \u0434\u043b\u044f ".concat(e.visitor),already_done:"".concat(e.visitor," \u0443\u0436\u0435 \u043f\u0440\u043e\u0445\u043e\u0434\u0438\u043b \u044d\u0442\u043e\u0442 \u043a\u0432\u0435\u0441\u0442"),no_visitor:"\u041f\u043e\u0441\u0435\u0442\u0438\u0442\u0435\u043b\u044c \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d"}[e.res]||e.res)})]})}const Be={btn:"styles_btn__w12Ul"};function We(){return(0,g.jsxs)(T,{centered:!0,gap:"0.8rem",children:[v("manage_store")&&(0,g.jsx)(I.rU,{to:"/manage_store",className:Be.btn,children:"\u0423\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u043c\u0430\u0433\u0430\u0437\u0438\u043d\u043e\u043c"}),v("manage_quest")&&(0,g.jsx)(I.rU,{to:"/manage_quest",className:Be.btn,children:"\u0423\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u043a\u0432\u0435\u0441\u0442\u0430\u043c\u0438"}),v("page_scanner_quest")&&(0,g.jsx)(I.rU,{to:"/scanner_quest",className:Be.btn,children:"\u0414\u043b\u044f \u043a\u0432\u0435\u0441\u0442\u043e\u0432\u0438\u043a\u043e\u0432"}),v("page_scanner_store")&&(0,g.jsx)(I.rU,{to:"/scanner_store",className:Be.btn,children:"\u0414\u043b\u044f \u043f\u0440\u043e\u0434\u0430\u0432\u0446\u043e\u0432"}),v("promote_worker")&&(0,g.jsx)(I.rU,{to:"/promote_worker",className:Be.btn,children:"\u041f\u043e\u0432\u044b\u0441\u0438\u0442\u044c \u0434\u043e \u0432\u043e\u043b\u043e\u043d\u0442\u0451\u0440\u0430"}),v("promote_manager")&&(0,g.jsx)(I.rU,{to:"/promote_manager",className:Be.btn,children:"\u041f\u043e\u0432\u044b\u0441\u0438\u0442\u044c \u0434\u043e \u0443\u043f\u0440\u0430\u0432\u043b\u044f\u044e\u0449\u0435\u0433\u043e"})]})}const Ye={root:"styles_root__d985G",quests:"styles_quests__TBzNh"};function Ge(){var e;const s=ge();return(0,g.jsxs)(T,{centered:!0,gap:"1rem",className:Ye.root,children:[s.isLoading&&(0,g.jsx)(P,{}),y(s),(0,g.jsx)("h2",{children:"\u041a\u0430\u043a\u043e\u0439 \u043a\u0432\u0435\u0441\u0442 \u0432\u044b \u043f\u0440\u043e\u0432\u043e\u0434\u0438\u0442\u0435?"}),(0,g.jsx)("div",{className:Ye.quests,children:null===(e=s.data)||void 0===e?void 0:e.map((e=>(0,g.jsx)(I.rU,{to:"/scanner_quest/"+e.id,children:e.name},e.id)))})]})}const Xe={root:"styles_root__jLTkZ",title:"styles_title__oIrEy",item:"styles_item__rXv3s",item__img:"styles_item__img__O-P1T",item__desc:"styles_item__desc__zxJ9K",btns:"styles_btns__9aQ2N",btn_deny:"styles_btn_deny__7EPCy",btn_ok:"styles_btn_ok__WFDzm"};function Je(){const[e,s]=(0,j.useState)(!1),[t,n]=(0,j.useState)(!1),[l,i]=(0,j.useState)(null),a=function(e,s){return(0,r.useMutation)({mutationFn:async e=>await d("/api/store_sell",e),onSuccess:e,onError:s})}(c,c);function o(){s(!1),n(!1)}function c(){n(!1)}return(0,g.jsxs)(T,{className:Xe.root,children:[a.isLoading&&(0,g.jsx)(P,{}),(0,g.jsx)("div",{className:Xe.title,children:(0,g.jsx)("h3",{children:"\u041f\u0440\u043e\u0441\u043a\u0430\u043d\u0438\u0440\u0443\u0439\u0442\u0435 qr-\u043a\u043e\u0434 \u043f\u043e\u0441\u0435\u0442\u0438\u0442\u0435\u043b\u044f, \u0447\u0442\u043e\u0431\u044b \u043f\u0440\u043e\u0434\u0430\u0442\u044c \u0435\u043c\u0443 \u0442\u043e\u0432\u0430\u0440."})}),(0,g.jsx)(Re,{useMutation:we,pause:e,onScan:e=>{const s=e.split(";");if(2!=s.length)return null;const[t,n]=s;if(!t.startsWith("user_")||!n.startsWith("item_"))return null;const r=t.slice(5),l=parseInt(n.slice(5),10);return isNaN(l)?null:{userId:r,itemId:l}},formatMsg:e=>{var s;return null!==(s={ok:"",no_item:"\u0422\u043e\u0432\u0430\u0440 \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d",no_visitor:"\u041f\u043e\u043a\u0443\u043f\u0430\u0442\u0435\u043b\u044c \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d",no_money:"\u0423 ".concat(e.visitor," \u043d\u0435 \u0445\u0432\u0430\u0442\u0430\u0435\u0442 \u0441\u0440\u0435\u0434\u0441\u0442\u0432")}[e.res])&&void 0!==s?s:e.res},onRes:e=>{"ok"==e.res&&(s(!0),n(!0),i(e))}}),(0,g.jsxs)(ee,{title:"\u041f\u0440\u043e\u0434\u0430\u0436\u0430 \u0442\u043e\u0432\u0430\u0440\u0430",open:t,closeOnOutclick:!1,close:o,children:[(0,g.jsxs)("h3",{children:[null===l||void 0===l?void 0:l.visitor," \u0445\u043e\u0447\u0435\u0442 \u043a\u0443\u043f\u0438\u0442\u044c:"]}),(0,g.jsxs)("div",{className:Xe.item,children:[(0,g.jsx)("div",{className:Xe.item__img,children:(0,g.jsx)("img",{src:null===l||void 0===l?void 0:l.item.img,alt:"\u0422\u043e\u0432\u0430\u0440"})}),(0,g.jsxs)("div",{className:Xe.item__desc,children:[(0,g.jsx)("span",{children:null===l||void 0===l?void 0:l.item.name}),(0,g.jsxs)("span",{children:[null===l||void 0===l?void 0:l.item.price," G"]})]})]}),(0,g.jsx)("p",{children:"\u0412\u044b\u0434\u0430\u0439\u0442\u0435 \u0442\u043e\u0432\u0430\u0440 \u0438 \u043f\u043e\u0434\u0442\u0432\u0435\u0440\u0434\u0438\u0442\u0435 \u043f\u043e\u043a\u0443\u043f\u043a\u0443:"}),(0,g.jsxs)("div",{className:Xe.btns,children:[(0,g.jsx)("button",{className:Xe.btn_deny,onClick:o,children:"\u041e\u0442\u043a\u043b\u043e\u043d\u0438\u0442\u044c"}),(0,g.jsx)("button",{className:Xe.btn_ok,onClick:()=>{a.mutate({userId:l.visitorId,itemId:l.itemId})},children:"\u041f\u043e\u0434\u0442\u0432\u0435\u0440\u0434\u0438\u0442\u044c"})]})]}),(0,g.jsxs)(ee,{title:"\u041f\u0440\u043e\u0434\u0430\u0436\u0430 \u0442\u043e\u0432\u0430\u0440\u0430",open:a.isSuccess||a.isError,close:function(){a.reset(),s(!1)},children:[a.isSuccess&&("ok"==a.data.res?(0,g.jsxs)("h2",{children:["\u0422\u043e\u0432\u0430\u0440 ",a.data.item," \u0443\u0441\u043f\u0435\u0448\u043d\u043e \u043f\u0440\u043e\u0434\u0430\u043d \u043f\u043e\u0441\u0435\u0442\u0438\u0442\u0435\u043b\u044e ",a.data.visitor]}):(0,g.jsxs)("h2",{children:["\u0423 ",a.data.visitor," \u043d\u0435 \u0445\u0432\u0430\u0442\u0430\u0435\u0442 \u0441\u0440\u0435\u0434\u0441\u0442\u0432 \u043d\u0430 \u043f\u043e\u043a\u0443\u043f\u043a\u0443 ",a.data.item]})),y(a)]})]})}function Ke(e,s){return(0,r.useMutation)({mutationFn:async e=>await d("/api/promote_worker",e),onSuccess:e,onError:s})}function Ve(e,s){return(0,r.useMutation)({mutationFn:async e=>await d("/api/promote_manager",e),onSuccess:e,onError:s})}const Ze={root:"styles_root__sSzNc",title:"styles_title__05ult"};function $e(e){let{role:s}=e;const t={worker:"\u0432\u043e\u043b\u043e\u043d\u0442\u0451\u0440\u0430",manager:"\u0443\u043f\u0440\u0430\u0432\u043b\u044f\u044e\u0449\u0435\u0433\u043e"}[s],n={worker:"\u0432\u043e\u043b\u043e\u043d\u0442\u0451\u0440",manager:"\u0443\u043f\u0440\u0430\u0432\u043b\u044f\u044e\u0449\u0438\u0439"}[s];return t?(0,g.jsxs)(T,{className:Ze.root,children:[(0,g.jsx)("div",{className:Ze.title,children:(0,g.jsxs)("h3",{children:["\u041f\u0440\u043e\u0441\u043a\u0430\u043d\u0438\u0440\u0443\u0439\u0442\u0435 qr-\u043a\u043e\u0434 \u0447\u0435\u043b\u043e\u0432\u0435\u043a, \u0447\u0442\u043e\u0431\u044b \u043f\u043e\u0432\u044b\u0441\u0438\u0442\u044c \u0435\u0433\u043e \u0434\u043e ",t,"."]})}),(0,g.jsx)(Re,{useMutation:{worker:Ke,manager:Ve}[s],onScan:e=>{if(!e.startsWith("user_"))return null;return{userId:e.slice(5)}},formatMsg:e=>({ok:"".concat(e.user," \u043f\u043e\u0432\u044b\u0448\u0435\u043d \u0434\u043e ").concat(t),already_has:"".concat(e.user," \u0443\u0436\u0435 ").concat(n),no_user:"\u0427\u0435\u043b\u043e\u0432\u0435\u043a \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d"}[e.res]||e.res)})]}):(0,g.jsx)(T,{children:"\u041e\u0448\u0438\u0431\u043a\u0430!"})}function es(e,s){let[t,n]=(0,j.useState)(e);return s&&(n=e=>{n(e),s()}),{v:t,set:n,setT:()=>n(!0),setF:()=>n(!1)}}const ss={root:"styles_root__yl-I8",img:"styles_img__gddIw"};async function ts(e,s){const t=await new Promise((s=>{var t=new FileReader;t.addEventListener("loadend",(e=>{s({result:t.result,error:t.error})})),t.readAsDataURL(e)}));return t.error?(console.error(t.error),null):{data:t.result,name:s}}function ns(e,s){const[t,n]=(0,j.useState)(e);return s?{v:t,set:e=>{n(e),s()}}:{v:t,set:n}}function rs(){var e;const s=ns(null),t=(0,j.useRef)(null),n=(0,j.useRef)(null),l=(0,j.useRef)(null),i=es(!1),a=function(e,s){const t=(0,r.useQueryClient)();return(0,r.useMutation)({mutationFn:async e=>await d("/api/store_item",e),onSuccess:s=>{var n;"success"==(null===(n=t.getQueryState("storeItems"))||void 0===n?void 0:n.status)&&t.setQueryData("storeItems",(e=>e?[...e,s]:[s])),null===e||void 0===e||e(s)},onError:s})}((()=>{s.set(null),i.setF(),t.current&&(t.current.value=""),n.current&&(n.current.value=""),l.current&&(l.current.value="")}));return(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)("button",{className:ss.root,onClick:i.setT,children:"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c"}),(0,g.jsxs)(ee,{title:"\u0414\u043e\u0431\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u0442\u043e\u0432\u0430\u0440\u0430",open:i.v,close:i.setF,closeOnOutclick:!1,children:[a.isLoading&&(0,g.jsx)(P,{}),y(a),""==(null===(e=s.v)||void 0===e?void 0:e.data)&&(0,g.jsx)(P,{}),(0,g.jsxs)(B,{onSubmit:()=>{var e,r,i;const o=null===(e=t.current)||void 0===e?void 0:e.value,c=null===(r=l.current)||void 0===r?void 0:r.valueAsNumber,d=null===(i=n.current)||void 0===i?void 0:i.valueAsNumber;c&&o&&d&&a.mutate({count:c,name:o,price:d,img:s.v||void 0})},children:[(0,g.jsxs)(W,{label:"\u0418\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435",children:[(0,g.jsx)("div",{className:ss.img,children:s.v&&(0,g.jsx)("img",{src:s.v.data,alt:"\u0418\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435"})}),(0,g.jsx)("input",{type:"file",style:{display:"none"},onChange:async e=>{var t,n;s.set({data:"",name:""}),s.set(await ts(null===(t=e.target)||void 0===t||null===(n=t.files)||void 0===n?void 0:n[0],""))}})]}),(0,g.jsx)(W,{label:"\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435",children:(0,g.jsx)("input",{ref:t,required:!0,type:"text"})}),(0,g.jsx)(W,{label:"\u0426\u0435\u043d\u0430",children:(0,g.jsx)("input",{ref:n,required:!0,type:"number"})}),(0,g.jsx)(W,{label:"\u041a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e",children:(0,g.jsx)("input",{ref:l,required:!0,type:"number"})}),(0,g.jsx)(W,{children:(0,g.jsx)("button",{type:"submit",children:"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c"})})]})]})]})}const ls={button:"styles_button__MKylh"};function is(e){let{title:s,mutationFn:t,mutatateParams:n,itemId:r,onSuccess:l,open:i,close:a}=e;const o=t(r,(e=>{null===a||void 0===a||a(),null===l||void 0===l||l(e)}));return(0,j.useEffect)((()=>{i||o.reset()}),[i]),(0,g.jsxs)(ee,{open:i,close:a,title:"\u0412\u044b \u0443\u0432\u0435\u0440\u0435\u043d\u044b?",children:[y(o),o.isLoading&&(0,g.jsx)(P,{}),(0,g.jsxs)(B,{onSubmit:()=>{o.mutate(n)},children:[(0,g.jsx)("h2",{children:s}),(0,g.jsx)("button",{type:"submit",className:ls.button,children:"\u041f\u043e\u0434\u0442\u0432\u0435\u0440\u0434\u0438\u0442\u044c"})]})]})}const as={root:"styles_root__792UO",error:"styles_error__EjE0M",id:"styles_id__EvI3k",img:"styles_img__F6UZc",inputs:"styles_inputs__r6vu+",changed:"styles_changed__aaZPg",buttons:"styles_buttons__X3oNY",btnMinus:"styles_btnMinus__5ZzMA"};function os(e){var s,t;let{item:n}=e;const l=es(!1),i=es(!1),a=es(!1),o=ns(null,l.setT),c=ns(n.name,l.setT),u=ns(n.count,l.setT),m=ns(n.price,l.setT),h=function(e,s){const t=(0,r.useQueryClient)();return(0,r.useMutation)({mutationFn:async e=>await d("/api/store_item/".concat(e.id),e),onSuccess:s=>{var n;"success"==(null===(n=t.getQueryState("storeItems"))||void 0===n?void 0:n.status)&&t.setQueryData("storeItems",(e=>(null===e||void 0===e?void 0:e.map((e=>e.id==s.id?s:e)))||[])),null===e||void 0===e||e(s)},onError:s})}(_,(()=>_()));function _(e){o.set(null),c.set((null===e||void 0===e?void 0:e.name)||n.name),u.set((null===e||void 0===e?void 0:e.count)||n.count),m.set((null===e||void 0===e?void 0:e.price)||n.price),l.setF()}return(0,j.useEffect)(_,[n]),(0,g.jsxs)("div",{className:A(as.root,l.v&&as.changed),children:[h.isLoading&&(0,g.jsx)(P,{block:!0,r:"0.5rem"}),""==(null===(s=o.v)||void 0===s?void 0:s.data)&&(0,g.jsx)(P,{block:!0,r:"0.5rem"}),y(h,(e=>(0,g.jsxs)("div",{className:as.error,children:[(0,g.jsx)("div",{children:e}),(0,g.jsx)("button",{onClick:()=>h.reset(),children:"\u041e\u041a"})]}))),(0,g.jsx)(is,{title:"\u0423\u0434\u0430\u043b\u0438\u0442\u044c \u0442\u043e\u0432\u0430\u0440: "+c.v,itemId:n.id,mutationFn:Se,open:i.v,close:i.setF}),(0,g.jsx)(is,{title:"\u0423\u043c\u0435\u043d\u044c\u0448\u0438\u0442\u044c \u043a\u043e\u043b-\u0432\u043e \u043d\u0430 1: "+c.v,itemId:n.id,mutationFn:ke,open:a.v,close:a.setF}),(0,g.jsx)("div",{className:as.id,children:n.id}),(0,g.jsxs)("label",{className:as.img,children:[(n.img||o.v)&&(0,g.jsx)("img",{src:(null===(t=o.v)||void 0===t?void 0:t.data)||n.img,alt:"\u041a\u0430\u0440\u0442\u0438\u043d\u043a\u0430"}),(0,g.jsx)("input",{type:"file",style:{display:"none"},onChange:async e=>{var s,t;o.set({data:"",name:""}),o.set(await ts(null===(s=e.target)||void 0===s||null===(t=s.files)||void 0===t?void 0:t[0],"")),e.target.value=""}})]}),(0,g.jsxs)("div",{className:as.inputs,children:[(0,g.jsx)("div",{children:"\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435"}),(0,g.jsx)("input",{type:"text",value:c.v,onChange:e=>c.set(e.target.value)}),(0,g.jsx)("div",{children:"\u0426\u0435\u043d\u0430"}),(0,g.jsx)("input",{type:"number",value:m.v,onChange:e=>m.set(e.target.valueAsNumber)}),(0,g.jsx)("div",{children:"\u041a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e"}),(0,g.jsx)("input",{type:"number",value:u.v,onChange:e=>u.set(e.target.valueAsNumber)})]}),(0,g.jsxs)("div",{className:A("material_symbols",as.buttons),children:[!l.v&&(0,g.jsx)("button",{onClick:i.setT,children:"delete"}),!l.v&&(0,g.jsx)("button",{className:as.btnMinus,onClick:a.setT,children:"-1"}),l.v&&(0,g.jsx)("button",{onClick:()=>{h.mutate({id:n.id,name:c.v,count:u.v,price:m.v,img:o.v||void 0})},children:"save"}),l.v&&(0,g.jsx)("button",{onClick:()=>_(),children:"cancel"})]})]})}const cs={items:"styles_items__34Dlt"};function ds(){var e;const s=He();return(0,g.jsxs)(T,{centeredPage:!0,gap:"0.5rem",children:[s.isLoading&&(0,g.jsx)(P,{}),y(s),(0,g.jsx)("h1",{children:"\u0423\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u043c\u0430\u0433\u0430\u0437\u0438\u043d\u043e\u043c"}),(0,g.jsx)(rs,{}),(0,g.jsx)("div",{className:cs.items,children:null===(e=s.data)||void 0===e?void 0:e.map((e=>(0,g.jsx)(os,{item:e},e.id)))})]})}function us(){var e,s;const t=m();function r(e,s,r){var l;return(0,g.jsx)(n.AW,{path:s,element:null!==(l=t.data)&&void 0!==l&&l.auth?null==e||_(t,e)?r:(0,g.jsx)(D,{}):(0,g.jsx)(n.Fg,{to:"/login"})})}return(0,g.jsxs)("div",{className:"root",children:[(0,g.jsx)(f,{}),(0,g.jsx)(w,{}),t.isLoading&&(0,g.jsx)(x.Z,{}),y(t),t.isSuccess&&(0,g.jsxs)(n.Z5,{children:[(0,g.jsx)(n.AW,{path:"/",element:(0,g.jsx)(V,{})}),(0,g.jsx)(n.AW,{path:"/login",element:null!==(e=t.data)&&void 0!==e&&e.auth?(0,g.jsx)(n.Fg,{to:"/"}):(0,g.jsx)(he,{})}),(0,g.jsx)(n.AW,{path:"/auth",element:null!==(s=t.data)&&void 0!==s&&s.auth?(0,g.jsx)(n.Fg,{to:"/"}):(0,g.jsx)(Y,{})}),(0,g.jsx)(n.AW,{path:"/timetable",element:(0,g.jsx)(fe,{})}),(0,g.jsx)(n.AW,{path:"/quest",element:(0,g.jsx)(Ne,{})}),(0,g.jsx)(n.AW,{path:"/store",element:(0,g.jsx)(Ie,{})}),r(null,"/profile",(0,g.jsx)(ve,{})),r("page_worker","/worker",(0,g.jsx)(We,{})),r("manage_store","/manage_store",(0,g.jsx)(ds,{})),r("page_scanner_quest","/scanner_quest",(0,g.jsx)(Ge,{})),r("page_scanner_quest","/scanner_quest/:questId",(0,g.jsx)(ze,{})),r("page_scanner_store","/scanner_store",(0,g.jsx)(Je,{})),r("promote_worker","/promote_worker",(0,g.jsx)($e,{role:"worker"})),r("promote_manager","/promote_manager",(0,g.jsx)($e,{role:"manager"})),r("page_debug","/debug",(0,g.jsx)(se,{})),r("page_debug","/log",(0,g.jsx)(ce,{})),r("page_users","/users",(0,g.jsx)(ne,{})),(0,g.jsx)(n.AW,{path:"*",element:(0,g.jsx)(U,{})})]})]})}}}]);
//# sourceMappingURL=339.5fc57d0b.chunk.js.map