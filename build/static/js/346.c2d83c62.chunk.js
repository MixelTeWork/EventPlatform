"use strict";(self.webpackChunkevent_platform=self.webpackChunkevent_platform||[]).push([[346],{1604:(e,s,t)=>{t.r(s),t.d(s,{default:()=>Ue});var n=t(7689),l=t(1933);class r extends Error{}async function a(e,s,t){const n=await fetch(s,{method:e,headers:{"Content-Type":"application/json"},body:void 0===t?null:JSON.stringify(t)});if(!n.ok)throw new r((await n.json()).msg);return n}function i(e,s){return a("POST",e,s)}async function o(e,s,t){const n=await a(e,s,t);return await n.json()}function c(e,s){return o("GET",e,s)}function d(e,s){return o("POST",e,s)}function u(){return(0,l.useQuery)("user",h)}async function h(){const e=await fetch("/api/user"),s=await e.json();if(401==e.status)return{auth:!1,id:-1,balance:0,login:"",roles:[],name:"",operations:[]};if(!e.ok)throw new r(s.msg);const t=s;return t.auth=!0,t}function m(e,s){var t,n;return!(null===(t=e.data)||void 0===t||!t.auth||null===(n=e.data)||void 0===n||!n.operations.includes(s))}function f(e){return m(u(),e)}var x=t(5086),_=t(2791);function j(){const{pathname:e}=(0,n.TH)();return(0,_.useEffect)((()=>{window.scrollTo(0,0)}),[e]),null}var v=t(184);function g(e,s,t){if(!e.isError)return null;const n=e.error instanceof r?e.error.message:"\u041e\u0448\u0438\u0431\u043a\u0430";return(s||A)(t?t(n):n)}function A(e){return(0,v.jsx)("h3",{style:{color:"tomato",textAlign:"center"},children:e})}function p(){for(var e=arguments.length,s=new Array(e),t=0;t<e;t++)s[t]=arguments[t];return s.filter((e=>!!e)).join(" ")}const y={root:"styles_root__hzHjz",visible:"styles_visible__6aD-n",close:"styles_close__3L8iW",message:"styles_message__oF8zk"};let b="";function H(){const[e,s]=(0,_.useState)("");return(0,_.useEffect)((()=>{const e=setInterval((()=>{const e=function(e){let s=document.cookie.match(new RegExp("(?:^|; )"+e.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g,"\\$1")+"=([^;]*)"));return s?decodeURIComponent(s[1]):void 0}("MESSAGE_TO_FRONTEND");e!=b&&(b=e||"",s(b))}),1e3);return()=>{clearInterval(e)}}),[s]),(0,v.jsxs)("div",{className:p(y.root,""!=e&&y.visible),children:[(0,v.jsx)("button",{className:y.close,onClick:()=>s("")}),(0,v.jsx)("div",{className:y.message,children:N(e)})]})}function N(e){return'"'==e.at(0)&&(e=e.slice(1)),'"'==e.at(-1)&&(e=e.slice(0,-1)),e}const w={root:"styles_root__4DGhY"};function C(){const e=(0,n.s0)();return(0,v.jsx)("div",{className:w.root,children:(0,v.jsx)("button",{onClick:()=>e(-1),className:"button button_light",children:"\u041d\u0430\u0437\u0430\u0434"})})}var k=t(1087);const S={root:"styles_root__Zvl9c",home:"styles_home__o+-s7",block:"styles_block__a1SM7",balance:"styles_balance__PLLCC",user:"styles_user__0ltHf",menu:"styles_menu__WWgPh",menuVisible:"styles_menuVisible__mMGZn"};async function E(e){const s=await d("/api/auth",e);return s.auth=!0,s}async function P(){await i("/api/logout")}const L={root:"styles_root__BdzzK",spinner:"styles_spinner__rlI86","lds-ring":"styles_lds-ring__jnLuB"};function I(e){let{color:s,zIndex:t}=e;return(0,v.jsx)("div",{className:L.root,children:(0,v.jsxs)("div",{className:L.spinner,style:{"--color":s,zIndex:t},children:[(0,v.jsx)("div",{}),(0,v.jsx)("div",{}),(0,v.jsx)("div",{}),(0,v.jsx)("div",{})]})})}function Q(){var e,s,t;const[r,a]=(0,_.useState)(!1),i=(0,n.s0)(),o=function(e){const s=(0,l.useQueryClient)();return(0,l.useMutation)({mutationFn:P,onSuccess:()=>{s.invalidateQueries("user"),null===e||void 0===e||e()}})}((()=>{a(!1)})),c=u();return(0,v.jsxs)("div",{className:S.root,children:[(0,v.jsx)(k.rU,{to:"/",className:p(S.home,"material_symbols"),children:"home"}),(0,v.jsxs)("span",{className:S.block,children:[(0,v.jsxs)("div",{className:S.balance,children:[(null===(e=c.data)||void 0===e?void 0:e.balance)||0," G"]}),(0,v.jsx)("button",{className:S.user,onClick:()=>{var e;return null!==(e=c.data)&&void 0!==e&&e.auth?a((e=>!e)):i("/login")},children:(0,v.jsx)("span",{children:null!==(s=c.data)&&void 0!==s&&s.auth?null===(t=c.data)||void 0===t?void 0:t.name:"\u0412\u043e\u0439\u0442\u0438"})}),(0,v.jsxs)("div",{className:p(S.menu,r&&S.menuVisible),children:[(0,v.jsx)("button",{onClick:()=>i("/profile"),children:"\u041f\u0440\u043e\u0444\u0438\u043b\u044c"}),m(c,"page_debug")&&(0,v.jsx)(k.rU,{to:"/debug",children:"</>"}),m(c,"page_worker")&&(0,v.jsx)(k.rU,{to:"/worker",className:"material_symbols",children:"deployed_code"}),(0,v.jsx)("button",{onClick:()=>o.mutate(),disabled:"idle"!=o.status,children:"\u0412\u044b\u0439\u0442\u0438"})]})]}),"loading"==o.status&&(0,v.jsx)(I,{})]})}const q={root:"styles_root__xvR2N",hasFooter:"styles_hasFooter__lMS3o",body:"styles_body__S-p4X",body_centered:"styles_body_centered__NzRPU",body_centeredPage:"styles_body_centeredPage__R-EzO"};function F(e){let{children:s,className:t,styles:n,centered:l=!1,centeredPage:r=!1,height100:a=!1,gap:i=0,header:o,footer:c}=e;return void 0===o&&(o=(0,v.jsx)(Q,{})),(0,v.jsxs)("div",{className:p(q.root,!!c&&q.hasFooter),style:{...n,maxHeight:a?"100dvh":""},children:[o||(0,v.jsx)("div",{}),(0,v.jsx)("div",{className:p(q.body,t,l&&q.body_centered,r&&q.body_centeredPage),style:{gap:i,maxHeight:a?"100%":""},children:s}),c]})}function B(){return(0,v.jsx)(F,{centered:!0,header:(0,v.jsx)(C,{}),children:"\u0422\u0430\u043a\u043e\u0439 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u044b \u043d\u0435\u0442"})}function U(){return(0,v.jsx)(F,{centered:!0,header:(0,v.jsx)(C,{}),children:"\u0423 \u0432\u0430\u0441 \u043d\u0435\u0434\u043e\u0441\u0442\u0430\u0442\u0442\u043e\u0447\u043d\u043e \u043f\u0440\u0430\u0432 \u043d\u0430 \u043f\u0440\u043e\u0441\u043c\u043e\u0442\u0440 \u044d\u0442\u043e\u0439 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u044b"})}const T={back:"styles_back__uuJZO",form:"styles_form__n7Rcu"};function O(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"\u041c\u0435\u0440\u043e\u043f\u0440\u0438\u044f\u0442\u0438\u0435";(0,_.useEffect)((()=>{const t=document.title,n="object"!=typeof e?[e]:e;return document.title=[s,...n].filter((e=>!!e)).join(" | "),()=>{document.title=t}}),[e,s])}const z={form:"styles_form__cFFCH",field:"styles_field__5rpBk"};function D(e){let{className:s,style:t,onSubmit:n,children:l}=e;return(0,v.jsx)("form",{className:p(z.form,s),style:t,onSubmit:e=>{e.preventDefault(),n()},children:l})}function W(e){let{label:s,className:t,style:n,children:l}=e;return(0,v.jsxs)("label",{className:p(z.field,t),style:n,children:[(0,v.jsx)("span",{children:s}),l]})}function Y(){O("\u0410\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0438\u044f");const[e,s]=(0,_.useState)(""),t=(0,_.useRef)(null),n=(0,_.useRef)(null),a=function(e){const s=(0,l.useQueryClient)(),t=(0,l.useMutation)({mutationFn:E,onSuccess:e=>{s.setQueryData("user",(()=>e))},onError:s=>{null===e||void 0===e||e(s instanceof r?s.message:"\u041f\u0440\u043e\u0438\u0437\u043e\u0448\u043b\u0430 \u043e\u0448\u0438\u0431\u043a\u0430, \u043f\u043e\u043f\u0440\u043e\u0431\u0443\u0439\u0442\u0435 \u0435\u0449\u0451 \u0440\u0430\u0437")}});return t}(s);return(0,v.jsxs)(F,{header:null,centered:!0,centeredPage:!0,gap:"2em",children:[(0,v.jsx)(k.rU,{to:"/",className:p(T.back,"material_symbols"),children:"arrow_back"}),(0,v.jsx)("h1",{children:"\u041c\u0435\u0440\u043e\u043f\u0440\u0438\u044f\u0442\u0438\u0435"}),e&&(0,v.jsx)("h3",{children:e}),a.isLoading&&(0,v.jsx)(I,{}),(0,v.jsxs)(D,{className:T.form,onSubmit:function(){var e,s;const l=(null===(e=t.current)||void 0===e?void 0:e.value)||"",r=(null===(s=n.current)||void 0===s?void 0:s.value)||"";a.mutate({login:l,password:r})},children:[(0,v.jsx)(W,{label:"\u041b\u043e\u0433\u0438\u043d",children:(0,v.jsx)("input",{ref:t,type:"text",name:"login",required:!0})}),(0,v.jsx)(W,{label:"\u041f\u0430\u0440\u043e\u043b\u044c",children:(0,v.jsx)("input",{ref:n,type:"password",name:"password",required:!0})}),(0,v.jsx)("button",{type:"submit",className:"button button_light button_small",disabled:"loading"==a.status,children:"\u0412\u043e\u0439\u0442\u0438"})]})]})}const G={root:"styles_root__h8xNs",title:"styles_title__+su+v",map:"styles_map__giu5H"},R=t.p+"static/media/map.b7c468d134662b591994.png",M={root:"styles_root__cV7H9"};function J(e){let{curPage:s}=e;return(0,v.jsxs)("div",{className:M.root,children:["map"!=s&&(0,v.jsx)(k.rU,{to:"/",children:"\u041a\u0430\u0440\u0442\u0430"}),"timetable"!=s&&(0,v.jsx)(k.rU,{to:"/timetable",children:"\u0420\u0430\u0441\u043f\u0438\u0441\u0430\u043d\u0438\u0435"}),"quest"!=s&&(0,v.jsx)(k.rU,{to:"/quest",children:"\u041a\u0432\u0435\u0441\u0442\u044b"}),"store"!=s&&(0,v.jsx)(k.rU,{to:"/store",children:"\u041c\u0430\u0433\u0430\u0437\u0438\u043d"})]})}function X(){return(0,v.jsxs)(F,{centeredPage:!0,gap:"1em",className:G.root,footer:(0,v.jsx)(J,{curPage:"map"}),children:[(0,v.jsx)("h1",{className:G.title,children:"Underparty"}),(0,v.jsx)("div",{className:G.map,children:(0,v.jsx)("img",{src:R,alt:"\u041a\u0430\u0440\u0442\u0430"})})]})}const V={root:"styles_root__O0923",hidden:"styles_hidden__eYJaf",open:"styles_open__35Vcu",popup:"styles_popup__L-0H0",header:"styles_header__o87wG",close:"styles_close__w0Yhz",body:"styles_body__t75Nd"};function K(e){let{children:s,open:t=!1,close:n,title:l="",closeOnOutclick:r=!0}=e;const a=(0,_.useRef)(null),[i,o]=(0,_.useState)(t),[c,d]=(0,_.useState)(!t);return(0,_.useEffect)((()=>{if(t){d(!1);const e=setTimeout((()=>o(!0)),100);return()=>clearTimeout(e)}o(!1);const e=setTimeout((()=>d(!0)),250);return()=>clearTimeout(e)}),[t]),(0,v.jsx)("div",{ref:a,className:p(V.root,i&&V.open,c&&V.hidden),onClick:e=>{r&&e.target==a.current&&(null===n||void 0===n||n())},children:(0,v.jsxs)("div",{className:V.popup,children:[(l||n)&&(0,v.jsxs)("div",{className:V.header,children:[(0,v.jsx)("h3",{children:l}),n&&(0,v.jsx)("button",{className:V.close,onClick:n})]}),(0,v.jsx)("div",{className:V.body,children:s})]})})}function Z(){const[e,s]=(0,_.useState)(""),[t,n]=(0,_.useState)(""),l=(0,_.useRef)(null),r=(0,_.useRef)(null);return(0,v.jsxs)(F,{centered:!0,gap:"1rem",styles:{fontFamily:"'PT Sans', Arial"},children:[(0,v.jsx)(k.rU,{to:"/users",children:"Users"}),(0,v.jsx)(k.rU,{to:"/log",children:"Log"}),(0,v.jsx)("button",{onClick:async()=>{s("Loading");try{const e=await fetch("/api/debug/log_errors"),t=await e.text();s(t),setTimeout((()=>{var e,s,t,n;return null===(e=l.current)||void 0===e||null===(s=e.parentElement)||void 0===s?void 0:s.scrollTo(0,null===(t=l.current)||void 0===t||null===(n=t.parentElement)||void 0===n?void 0:n.scrollHeight)}),150)}catch(e){s(JSON.stringify(e))}},children:"Log errors"}),(0,v.jsx)("button",{onClick:async()=>{n("Loading");try{const e=await fetch("/api/debug/log_info"),s=await e.text();n(s),setTimeout((()=>{var e,s,t,n;return null===(e=r.current)||void 0===e||null===(s=e.parentElement)||void 0===s?void 0:s.scrollTo(0,null===(t=r.current)||void 0===t||null===(n=t.parentElement)||void 0===n?void 0:n.scrollHeight)}),150)}catch(e){n(JSON.stringify(e))}},children:"Log requests"}),(0,v.jsx)(K,{title:"logErrors",open:""!=e,close:()=>s(""),children:(0,v.jsx)("pre",{ref:l,children:e})}),(0,v.jsx)(K,{title:"log",open:""!=t,close:()=>n(""),children:(0,v.jsx)("pre",{ref:r,children:t})})]})}const $={user:"styles_user__WUZvf",title:"styles_title__Gd1jL",toggle:"styles_toggle__qlIwC",toggleInp:"styles_toggleInp__fGE-7",userInfo:"styles_userInfo__vgBlw",operations:"styles_operations__MGBbv"};function ee(){var e;O("\u041f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0438");const s=(0,l.useQuery)("users",(async()=>await c("/api/users")));return(0,v.jsxs)(F,{centeredPage:!0,gap:8,styles:{fontFamily:"'PT Sans', Arial"},children:[s.isLoading&&(0,v.jsx)("h3",{children:"\u0417\u0430\u0433\u0440\u0443\u0437\u043a\u0430"}),g(s),null===(e=s.data)||void 0===e?void 0:e.map((e=>(0,v.jsxs)("div",{className:$.user,children:[(0,v.jsx)("input",{type:"checkbox",className:$.toggleInp,id:"user".concat(e.id)}),(0,v.jsxs)("label",{className:$.title,htmlFor:"user".concat(e.id),children:[(0,v.jsxs)("div",{children:[(0,v.jsx)("div",{children:e.login}),(0,v.jsx)("div",{style:{color:"blue"},children:e.id}),(0,v.jsx)("div",{children:"|"}),(0,v.jsx)("div",{children:e.name})]}),(0,v.jsxs)("div",{children:[e.deleted&&(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)("div",{style:{color:"tomato"},children:"deleted"}),(0,v.jsx)("div",{children:"|"})]}),(0,v.jsx)("span",{children:e.roles.join(", ")}),(0,v.jsx)("div",{className:$.toggle})]})]}),(0,v.jsx)("div",{className:$.userInfo,children:(0,v.jsxs)("div",{children:[(0,v.jsx)("h4",{children:"Operations"}),(0,v.jsx)("div",{className:$.operations,children:e.operations.map(((e,s)=>(0,v.jsx)("div",{children:se(e)},s)))})]})})]},e.id)))]})}function se(e){const s={page:"#990099",add:"#008000",get:"#008000",change:"#006fb3",delete:"#b30000"};for(const t in s)if(e.startsWith(t))return(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)("span",{style:{color:s[t]},children:t}),(0,v.jsx)("span",{children:e.slice(t.length)})]});return(0,v.jsx)("span",{children:e})}function te(e){const s=e;return s.date=new Date(e.date),s}function ne(e,s){return"".concat(e).padStart(s,"0")}function le(e){let s=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return function(e){return e?arguments.length>1&&void 0!==arguments[1]&&arguments[1]?"".concat(e.getFullYear(),".").concat(ne(e.getMonth()+1,2),".").concat(ne(e.getDate(),2)):"".concat(ne(e.getDate(),2),".").concat(ne(e.getMonth()+1,2),".").concat(e.getFullYear()):""}(e,arguments.length>2&&void 0!==arguments[2]&&arguments[2])+" "+function(e){let s=arguments.length>1&&void 0!==arguments[1]&&arguments[1],t="".concat(ne(e.getHours(),2),":").concat(ne(e.getMinutes(),2));return s?t+":".concat(ne(e.getSeconds(),2)):t}(e,s)}const re={table:"styles_table__QLr-h",changesCell:"styles_changesCell__0wQDJ",changes:"styles_changes__EyS9f",btn:"styles_btn__H7b72"};function ae(){var e;O("Log");const s=(0,l.useQuery)("log",(async()=>(await c("/api/debug/log")).map(te)));return(0,v.jsxs)(F,{centeredPage:!0,styles:{fontFamily:"'PT Sans', Arial"},children:[s.isFetching&&(0,v.jsx)("h3",{children:"\u0417\u0430\u0433\u0440\u0443\u0437\u043a\u0430"}),g(s),!s.isFetching&&(0,v.jsx)("button",{className:re.btn,onClick:()=>s.refetch(),children:"Update"}),(0,v.jsxs)("table",{className:re.table,children:[(0,v.jsx)("thead",{children:(0,v.jsxs)("tr",{children:[(0,v.jsx)("th",{style:{minWidth:"9.5em"},children:"Date"}),(0,v.jsx)("th",{style:{minWidth:"4em"},children:"Action"}),(0,v.jsx)("th",{style:{minWidth:"9.5em"},children:"Table[id]"}),(0,v.jsx)("th",{children:"User[id]"}),(0,v.jsx)("th",{style:{width:"18em"},children:"Changes"})]})}),(0,v.jsx)("tbody",{children:null===(e=s.data)||void 0===e?void 0:e.map((e=>(0,v.jsxs)("tr",{children:[(0,v.jsx)("td",{children:le(e.date,!0,!0)}),(0,v.jsx)("td",{children:ie(e.actionCode)}),(0,v.jsxs)("td",{children:[e.tableName,"[",e.recordId,"]"]}),(0,v.jsxs)("td",{children:[e.userName," [",e.userId,"]"]}),(0,v.jsx)("td",{className:re.changesCell,children:(0,v.jsxs)("div",{className:re.changes,children:[(0,v.jsx)("input",{type:"checkbox",className:re.toggleInp,id:"item".concat(e.id)}),(0,v.jsx)("div",{children:e.changes.map((e=>(0,v.jsxs)("div",{children:[e[0],": ",JSON.stringify(e[1])," ","->"," ",JSON.stringify(e[2])]},e[0])))}),e.changes.length>0&&(0,v.jsx)("label",{className:re.btn,htmlFor:"item".concat(e.id),children:e.changes.length})]})})]},e.id)))})]})]})}function ie(e){return(0,v.jsx)("span",{style:{color:{added:"#008000",deleted:"#b30000",updated:"#006fb3",restored:"#990099"}[e]},children:e})}const oe={back:"styles_back__Qx6+G",auth:"styles_auth__p4qSS",login:"styles_login__HG64A"},ce="data:image/png;base64,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";function de(){return O("\u0410\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0438\u044f"),(0,v.jsxs)(F,{header:null,centered:!0,centeredPage:!0,gap:"2em",children:[(0,v.jsx)(k.rU,{to:"/",className:p(oe.back,"material_symbols"),children:"arrow_back"}),(0,v.jsx)(k.rU,{to:"/auth",className:oe.auth}),(0,v.jsx)("h1",{children:"Underparty"}),(0,v.jsxs)("button",{className:oe.login,children:[(0,v.jsx)("span",{children:"\u0412\u043e\u0439\u0442\u0438 \u0447\u0435\u0440\u0435\u0437"}),(0,v.jsx)("img",{src:ce,alt:"VK"})]})]})}const ue={root:"styles_root__Rm-tG",input:"styles_input__2tNlg",password:"styles_password__Om-1z"};function he(){var e,s,t;const n=u(),r=(0,_.useRef)(null),[a,o]=(0,_.useState)(!1),c=function(e){const s=(0,l.useQueryClient)();return(0,l.useMutation)({mutationFn:async e=>(await i("/api/user/change_name",e),e),onSuccess:t=>{var n;"success"==(null===(n=s.getQueryState("user"))||void 0===n?void 0:n.status)&&s.setQueryData("user",(e=>({...e,name:t.name}))),null===e||void 0===e||e()}})}();return(0,v.jsx)(F,{centered:!0,gap:"1rem",children:(0,v.jsxs)("div",{className:ue.root,children:[g(c),c.isLoading&&(0,v.jsx)(I,{}),(0,v.jsxs)("div",{children:[(0,v.jsx)("h3",{children:"\u0418\u043c\u044f"}),(0,v.jsx)("div",{children:(0,v.jsx)("input",{type:"text",ref:r,defaultValue:null===(e=n.data)||void 0===e?void 0:e.name,disabled:!a,className:ue.input})}),(0,v.jsxs)("div",{children:[!a&&(0,v.jsx)("button",{onClick:()=>o(!0),className:"button button_small",children:"\u0418\u0437\u043c\u0435\u043d\u0438\u0442\u044c"}),a&&(0,v.jsx)("button",{onClick:()=>{var e;o(!1),r.current&&(r.current.value=(null===(e=n.data)||void 0===e?void 0:e.name)||"")},className:"button button_small",children:"\u041e\u0442\u043c\u0435\u043d\u0430"}),a&&(0,v.jsx)("button",{onClick:()=>{o(!1),r.current&&c.mutate({name:r.current.value})},className:"button button_small",children:"\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c"})]})]}),(0,v.jsxs)("div",{children:[(0,v.jsx)("h3",{children:"\u041b\u043e\u0433\u0438\u043d"}),null===(s=n.data)||void 0===s?void 0:s.login]}),(0,v.jsxs)("div",{children:[(0,v.jsx)("h3",{children:"\u0420\u043e\u043b\u0438"}),null===(t=n.data)||void 0===t?void 0:t.roles.map(((e,s)=>(0,v.jsx)("div",{children:e},s)))]})]})})}const me={root:"styles_root__E5y+5",title:"styles_title__3QqY9",map:"styles_map__bsZaz"},fe=t.p+"static/media/timetable.9dbcb4664b2137d4198b.png";function xe(){return(0,v.jsxs)(F,{centeredPage:!0,gap:"1em",className:me.root,footer:(0,v.jsx)(J,{curPage:"timetable"}),children:[(0,v.jsx)("h1",{className:me.title,children:"Underparty"}),(0,v.jsx)("div",{className:me.map,children:(0,v.jsx)("img",{src:fe,alt:"\u0420\u0430\u0441\u043f\u0438\u0441\u0430\u043d\u0438\u0435"})})]})}function _e(){return(0,l.useQuery)("quests",(async()=>await c("/api/quests")))}const je={root:"styles_root__CEdGL",body:"styles_body__o-6ZK",bottom:"styles_bottom__zkZn6",title:"styles_title__6wHPv",btnQr:"styles_btnQr__94tox",quests:"styles_quests__58NxQ",quest:"styles_quest__65tbN"};var ve=t(741);function ge(e){let{code:s,scale:t=10,margin:n=1,color:l="#000000",colorBg:r="#ffffff"}=e;const[a,i]=(0,_.useState)("");return(0,_.useEffect)((()=>{s&&(i(""),ve.toDataURL(s,{errorCorrectionLevel:"H",scale:t,margin:n,color:{dark:l,light:r}},((e,s)=>i(s))))}),[s,l,t,n,r]),(0,v.jsx)("img",{src:a,alt:s,style:{width:"100%"}})}function Ae(){var e,s;const t=u(),[n,l]=(0,_.useState)(!1),r=_e();return(0,v.jsxs)(F,{centeredPage:!0,gap:"1em",className:je.root,footer:(0,v.jsx)(J,{curPage:"quest"}),children:[r.isLoading&&(0,v.jsx)(I,{}),(0,v.jsxs)("div",{className:je.body,children:[(0,v.jsx)("h1",{className:je.title,children:"Underparty"}),(0,v.jsxs)("div",{className:je.quests,children:[g(r),null===r||void 0===r||null===(e=r.data)||void 0===e?void 0:e.map((e=>(0,v.jsxs)("div",{className:je.quest,children:[(0,v.jsx)("span",{children:e.name}),(0,v.jsxs)("span",{children:[e.reward,"G"]})]},e.id)))]})]}),(0,v.jsx)("div",{className:je.bottom,children:(0,v.jsx)("button",{className:je.btnQr,onClick:()=>l(!0),children:"\u0417\u0430\u0432\u0435\u0440\u0448\u0438\u0442\u044c \u043a\u0432\u0435\u0441\u0442!"})}),(0,v.jsx)(K,{title:"\u0417\u0430\u0432\u0435\u0440\u0448\u0435\u043d\u0438\u0435 \u043a\u0432\u0435\u0441\u0442\u0430",open:n,close:()=>l(!1),children:null!==t&&void 0!==t&&null!==(s=t.data)&&void 0!==s&&s.auth?(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(ge,{code:"user_".concat(t.data.id),colorBg:"#ffffff00",scale:13}),(0,v.jsx)("h3",{children:"\u041f\u043e\u043a\u0430\u0436\u0438\u0442\u0435 qr-\u043a\u043e\u0434 \u043a\u0432\u0435\u0441\u0442\u043e\u0432\u0438\u043a\u0443"})]}):(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)("p",{children:"\u0414\u043b\u044f \u043f\u0440\u043e\u0445\u043e\u0436\u0434\u0435\u043d\u0438\u044f \u043a\u0432\u0435\u0441\u0442\u043e\u0432 \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e \u0432\u043e\u0439\u0442\u0438 \u0432 \u0441\u0438\u0441\u0442\u0435\u043c\u0443."}),(0,v.jsx)("p",{children:"\u041a\u043d\u043e\u043f\u043a\u0430 \u0432\u0445\u043e\u0434\u0430 \u043d\u0430\u0445\u043e\u0434\u0438\u0442\u044c\u0441\u044f \u0432 \u043f\u0440\u0430\u0432\u043e\u043c \u0432\u0435\u0440\u0445\u043d\u0435\u043c \u0443\u0433\u043b\u0443."})]})})]})}const pe={root:"styles_root__0CejE",title:"styles_title__u3Xt9",items:"styles_items__n-Fvc",item:"styles_item__zIxt2",item__img:"styles_item__img__r3iEr",item__desc:"styles_item__desc__wbcAM"};function ye(){var e,s;const t=u(),[n,r]=(0,_.useState)(!1),[a,i]=(0,_.useState)(null),o=(0,l.useQuery)("storeItems",(async()=>await c("/api/store_items")));return(0,v.jsxs)(F,{centeredPage:!0,gap:"1em",className:pe.root,footer:(0,v.jsx)(J,{curPage:"store"}),children:[o.isLoading&&(0,v.jsx)(I,{}),(0,v.jsx)("h1",{className:pe.title,children:"Underparty"}),(0,v.jsxs)("div",{className:pe.items,children:[g(o),null===o||void 0===o||null===(e=o.data)||void 0===e?void 0:e.map((e=>(0,v.jsxs)("button",{className:pe.item,onClick:()=>{i(e),r(!0)},children:[(0,v.jsx)("div",{className:pe.item__img,children:(0,v.jsx)("img",{src:"https://ipsumimg.dakovdev.com/512x512",alt:"\u0422\u043e\u0432\u0430\u0440"})}),(0,v.jsxs)("div",{className:pe.item__desc,children:[(0,v.jsx)("span",{children:e.name}),(0,v.jsxs)("span",{children:[e.price," G"]})]})]},e.id)))]}),(0,v.jsx)(K,{title:"\u041f\u043e\u043a\u0443\u043f\u043a\u0430 \u0442\u043e\u0432\u0430\u0440\u0430",open:n,close:()=>r(!1),children:null!==t&&void 0!==t&&null!==(s=t.data)&&void 0!==s&&s.auth?(0,v.jsx)(v.Fragment,{children:t.data.balance<((null===a||void 0===a?void 0:a.price)||0)?(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)("h2",{style:{marginBottom:8},children:"\u041a \u0441\u043e\u0436\u0430\u043b\u0435\u043d\u0438\u044e, \u044d\u0442\u043e\u0442 \u0442\u043e\u0432\u0430\u0440 \u0432\u0430\u043c \u043d\u0435 \u043f\u043e \u043a\u0430\u0440\u043c\u0430\u043d\u0443"}),(0,v.jsxs)("h2",{className:pe.item__desc,children:[(0,v.jsx)("span",{children:null===a||void 0===a?void 0:a.name}),(0,v.jsxs)("span",{children:[null===a||void 0===a?void 0:a.price," G"]})]}),(0,v.jsxs)("h2",{className:pe.item__desc,style:{marginBottom:8},children:[(0,v.jsx)("span",{children:"\u0412\u0430\u043c \u043d\u0435 \u0445\u0432\u0430\u0442\u0430\u0435\u0442:"}),(0,v.jsxs)("span",{children:[((null===a||void 0===a?void 0:a.price)||0)-t.data.balance," G"]})]}),(0,v.jsx)("h3",{children:"\u0412\u044b\u043f\u043e\u043b\u043d\u044f\u0439\u0442\u0435 \u043a\u0432\u0435\u0441\u0442\u044b \u0438 \u0440\u0430\u0437\u0431\u043e\u0433\u0430\u0442\u0435\u0435\u0442\u0435!"})]}):(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(ge,{code:"item_".concat(null===a||void 0===a?void 0:a.id),colorBg:"#ffffff00",scale:13}),(0,v.jsxs)("h2",{className:pe.item__desc,children:[(0,v.jsx)("span",{children:null===a||void 0===a?void 0:a.name}),(0,v.jsxs)("span",{children:[null===a||void 0===a?void 0:a.price," G"]})]}),(0,v.jsx)("h3",{children:"\u041f\u043e\u043a\u0430\u0436\u0438\u0442\u0435 qr-\u043a\u043e\u0434 \u043f\u0440\u043e\u0434\u0430\u0432\u0446\u0443"})]})}):(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)("p",{children:"\u0414\u043b\u044f \u0441\u043e\u0432\u0435\u0440\u0448\u0435\u043d\u0438\u044f \u043f\u043e\u043a\u0443\u043f\u043e\u043a \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e \u0432\u043e\u0439\u0442\u0438 \u0432 \u0441\u0438\u0441\u0442\u0435\u043c\u0443."}),(0,v.jsx)("p",{children:"\u041a\u043d\u043e\u043f\u043a\u0430 \u0432\u0445\u043e\u0434\u0430 \u043d\u0430\u0445\u043e\u0434\u0438\u0442\u044c\u0441\u044f \u0432 \u043f\u0440\u0430\u0432\u043e\u043c \u0432\u0435\u0440\u0445\u043d\u0435\u043c \u0443\u0433\u043b\u0443."})]})})]})}const be={error:"styles_error__EtK3I",video:"styles_video__b88Zl"},He=t.p+"static/media/beep.38f199e084efe5461ffd.mp3";var Ne=t(1096);let we=e=>{},Ce=()=>{},ke=!1,Se=null,Ee=null;function Pe(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:500;if(!Ee){Se=document.createElement("div"),document.body.appendChild(Se),Se.style.display="flex",Se.style.backgroundColor="black";const e=document.createElement("video");Se.appendChild(e),Ee=new Ne.Z(e,(e=>we(e.data)),{highlightScanRegion:!0,maxScansPerSecond:10})}(0,_.useEffect)((()=>(setTimeout((()=>{var e;return null===(e=Ee)||void 0===e?void 0:e.start().catch((()=>{setTimeout((()=>{var e;null===(e=Ee)||void 0===e||e.start().catch((()=>Ce()))}),250)})).then((()=>console.log("started")))}),100),()=>{var e;null===(e=Ee)||void 0===e||e.stop()})),[]);const[s,t]=(0,_.useState)(!1),[n,l]=(0,_.useState)(""),[r,a]=(0,_.useState)(ke),i=function(e){const[s]=(0,_.useState)((()=>{const s=new Audio(e);return s.preload="auto",s}));return()=>{s.currentTime=0,s.play()}}(He);return we=n=>{s||(l(n),t(!0),i(),setTimeout((()=>{l(""),t(!1)}),e))},Ce=()=>{ke=!0,a(!0)},r?{scanned:n,scanner:(0,v.jsxs)("div",{className:be.error,children:[(0,v.jsx)("h1",{children:"\u041d\u0435\u0442 \u0434\u043e\u0441\u0442\u0443\u043f\u0430 \u043a \u043a\u0430\u043c\u0435\u0440\u0435"}),(0,v.jsx)("p",{children:"\u0420\u0430\u0437\u0440\u0435\u0448\u0438\u0442\u0435 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u0435 \u043a\u0430\u043c\u0435\u0440\u044b \u044d\u0442\u043e\u043c\u0443 \u0441\u0430\u0439\u0442\u0443 \u0438 \u0431\u0440\u0430\u0443\u0437\u0435\u0440\u0443, \u043a\u043e\u0442\u043e\u0440\u044b\u0439 \u0432\u044b \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0442\u0435."}),(0,v.jsx)("p",{children:"\u041f\u043e\u0441\u043b\u0435 \u043f\u0435\u0440\u0435\u0437\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u0435 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u0443."})]})}:{scanned:n,scanner:(0,v.jsx)("div",{children:(0,v.jsx)("div",{ref:e=>{e&&(e.innerHTML="",e.appendChild(Se))},className:be.video})})}}const Le={root:"styles_root__91Sa8",title:"styles_title__Duk4+",bottom:"styles_bottom__+GWCU"};function Ie(){var e,s;const t=(0,n.UO)(),[r,a]=(0,_.useState)(""),i=parseInt(t.questId,10),{scanned:o,scanner:c}=Pe(),u=_e(),h=(m=e=>{a(e.res),setTimeout((()=>h.reset()),1e3)},(0,l.useMutation)({mutationFn:async e=>await d("/api/quest_complete",e),onSuccess:m}));var m;return(0,_.useEffect)((()=>{if(""==o||!h.isIdle)return;const e=parseInt(o.slice(5),10);isNaN(e)?a("\u0418\u0433\u0440\u043e\u043a \u043d\u0435 \u043e\u043f\u043e\u0437\u043d\u0430\u043d"):h.mutate({userId:e,questId:i})}),[o]),(0,v.jsxs)(F,{className:Le.root,children:[u.isLoading&&(0,v.jsx)(I,{}),h.isLoading&&(0,v.jsx)(I,{}),(0,v.jsxs)("div",{className:Le.title,children:[(0,v.jsx)("h2",{children:null===(e=u.data)||void 0===e||null===(s=e.find((e=>e.id==i)))||void 0===s?void 0:s.name}),(0,v.jsx)("h3",{children:"\u041f\u0440\u043e\u0441\u043a\u0430\u043d\u0438\u0440\u0443\u0439\u0442\u0435 qr-\u043a\u043e\u0434 \u043f\u043e\u0441\u0435\u0442\u0438\u0442\u0435\u043b\u044f, \u0447\u0442\u043e\u0431\u044b \u0437\u0430\u0441\u0447\u0438\u0442\u0430\u0442\u044c \u0435\u043c\u0443 \u044d\u0442\u043e\u0442 \u043a\u0432\u0435\u0441\u0442."}),g(u)]}),c,(0,v.jsxs)("div",{className:Le.bottom,children:[(0,v.jsx)("h2",{children:r}),g(h)]})]})}const Qe={btn:"styles_btn__w12Ul"};function qe(){return(0,v.jsxs)(F,{centered:!0,gap:"0.5rem",children:[f("page_scanner_quest")&&(0,v.jsx)(k.rU,{to:"/scanner_quest",className:Qe.btn,children:"\u0414\u043b\u044f \u043a\u0432\u0435\u0441\u0442\u043e\u0432\u0438\u043a\u043e\u0432"}),f("page_scanner_store")&&(0,v.jsx)(k.rU,{to:"/scanner_store",className:Qe.btn,children:"\u0414\u043b\u044f \u043f\u0440\u043e\u0434\u0430\u0432\u0446\u043e\u0432"})]})}const Fe={root:"styles_root__d985G",quests:"styles_quests__TBzNh"};function Be(){var e;const s=_e();return(0,v.jsxs)(F,{centered:!0,gap:"1rem",className:Fe.root,children:[s.isLoading&&(0,v.jsx)(I,{}),g(s),(0,v.jsx)("h2",{children:"\u041a\u0430\u043a\u043e\u0439 \u043a\u0432\u0435\u0441\u0442 \u0432\u044b \u043f\u0440\u043e\u0432\u043e\u0434\u0438\u0442\u0435?"}),(0,v.jsx)("div",{className:Fe.quests,children:null===(e=s.data)||void 0===e?void 0:e.map((e=>(0,v.jsx)(k.rU,{to:"/scanner_quest/"+e.id,children:e.name},e.id)))})]})}function Ue(){var e,s;const t=u();function l(e,s,l){var r;return(0,v.jsx)(n.AW,{path:s,element:null!==(r=t.data)&&void 0!==r&&r.auth?null==e||m(t,e)?l:(0,v.jsx)(U,{}):(0,v.jsx)(n.Fg,{to:"/auth"})})}return(0,v.jsxs)("div",{className:"root",children:[(0,v.jsx)(j,{}),(0,v.jsx)(H,{}),t.isLoading&&(0,v.jsx)(x.Z,{}),g(t),t.isSuccess&&(0,v.jsxs)(n.Z5,{children:[(0,v.jsx)(n.AW,{path:"/",element:(0,v.jsx)(X,{})}),(0,v.jsx)(n.AW,{path:"/login",element:null!==(e=t.data)&&void 0!==e&&e.auth?(0,v.jsx)(n.Fg,{to:"/"}):(0,v.jsx)(de,{})}),(0,v.jsx)(n.AW,{path:"/auth",element:null!==(s=t.data)&&void 0!==s&&s.auth?(0,v.jsx)(n.Fg,{to:"/"}):(0,v.jsx)(Y,{})}),(0,v.jsx)(n.AW,{path:"/timetable",element:(0,v.jsx)(xe,{})}),(0,v.jsx)(n.AW,{path:"/quest",element:(0,v.jsx)(Ae,{})}),(0,v.jsx)(n.AW,{path:"/store",element:(0,v.jsx)(ye,{})}),l(null,"/profile",(0,v.jsx)(he,{})),l("page_worker","/worker",(0,v.jsx)(qe,{})),l("page_scanner_quest","/scanner_quest",(0,v.jsx)(Be,{})),l("page_scanner_quest","/scanner_quest/:questId",(0,v.jsx)(Ie,{})),l("page_debug","/debug",(0,v.jsx)(Z,{})),l("page_debug","/log",(0,v.jsx)(ae,{})),l("page_users","/users",(0,v.jsx)(ee,{})),(0,v.jsx)(n.AW,{path:"*",element:(0,v.jsx)(B,{})})]})]})}}}]);
//# sourceMappingURL=346.c2d83c62.chunk.js.map