"use strict";(self.webpackChunkevent_platform=self.webpackChunkevent_platform||[]).push([[303],{1998:(e,s,t)=>{t.r(s),t.d(s,{default:()=>Ge});var n=t(7689),l=t(1933);class i extends Error{}async function r(e,s,t){const n=await fetch(s,{method:e,headers:{"Content-Type":"application/json"},body:void 0===t?null:JSON.stringify(t)});if(!n.ok)throw new i((await n.json()).msg);return n}function a(e,s){return r("POST",e,s)}async function o(e,s,t){const n=await r(e,s,t);return await n.json()}function c(e,s){return o("GET",e,s)}function d(e,s){return o("POST",e,s)}function u(){const e=(0,l.useQueryClient)();return()=>e.invalidateQueries("user")}function h(){return(0,l.useQuery)("user",m)}async function m(){const e=await fetch("/api/user"),s=await e.json();if(401==e.status)return{auth:!1,id:"",balance:0,roles:[],name:"",last_name:"",photo:"",complited_quests:[],operations:[]};if(!e.ok)throw new i(s.msg);const t=s;return t.auth=!0,t}function _(e,s){var t,n;return!(null===(t=e.data)||void 0===t||!t.auth||null===(n=e.data)||void 0===n||!n.operations.includes(s))}function x(e){return _(h(),e)}var f=t(5086),j=t(2791);function v(){const{pathname:e}=(0,n.TH)();return(0,j.useEffect)((()=>{window.scrollTo(0,0)}),[e]),null}var g=t(184);function p(e,s){const t=e instanceof i?e.message:"\u041e\u0448\u0438\u0431\u043a\u0430";return s?s(t):t}function A(e,s,t){if(!e.isError)return null;return(s||y)(p(e,t))}function y(e){return(0,g.jsx)("h3",{style:{color:"tomato",textAlign:"center"},children:e})}function b(){for(var e=arguments.length,s=new Array(e),t=0;t<e;t++)s[t]=arguments[t];return s.filter((e=>!!e)).join(" ")}const H={root:"styles_root__hzHjz",visible:"styles_visible__6aD-n",close:"styles_close__3L8iW",message:"styles_message__oF8zk"};let N="";function w(){const[e,s]=(0,j.useState)("");return(0,j.useEffect)((()=>{const e=setInterval((()=>{const e=function(e){let s=document.cookie.match(new RegExp("(?:^|; )"+e.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g,"\\$1")+"=([^;]*)"));return s?decodeURIComponent(s[1]):void 0}("MESSAGE_TO_FRONTEND");e!=N&&(N=e||"",s(N))}),1e3);return()=>{clearInterval(e)}}),[s]),(0,g.jsxs)("div",{className:b(H.root,""!=e&&H.visible),children:[(0,g.jsx)("button",{className:H.close,onClick:()=>s("")}),(0,g.jsx)("div",{className:H.message,children:k(e)})]})}function k(e){return'"'==e.at(0)&&(e=e.slice(1)),'"'==e.at(-1)&&(e=e.slice(0,-1)),e}const S={root:"styles_root__4DGhY"};function C(){const e=(0,n.s0)();return(0,g.jsx)("div",{className:S.root,children:(0,g.jsx)("button",{onClick:()=>e(-1),className:"button button_light",children:"\u041d\u0430\u0437\u0430\u0434"})})}var I=t(1087);const E={root:"styles_root__Zvl9c",home:"styles_home__o+-s7",block:"styles_block__a1SM7",balance:"styles_balance__PLLCC",user:"styles_user__0ltHf",menu:"styles_menu__WWgPh",img:"styles_img__vhWmb",menuVisible:"styles_menuVisible__mMGZn"};async function L(e){const s=await d("/api/auth",e);return s.auth=!0,s}async function P(){await a("/api/logout")}const Q={root:"styles_root__BdzzK",spinner:"styles_spinner__rlI86","lds-ring":"styles_lds-ring__jnLuB"};function q(e){let{color:s,zIndex:t}=e;return(0,g.jsx)("div",{className:Q.root,children:(0,g.jsxs)("div",{className:Q.spinner,style:{"--color":s,zIndex:t},children:[(0,g.jsx)("div",{}),(0,g.jsx)("div",{}),(0,g.jsx)("div",{}),(0,g.jsx)("div",{})]})})}function F(){var e,s,t,i;const[r,a]=(0,j.useState)(!1),o=(0,n.s0)(),c=function(e){const s=(0,l.useQueryClient)();return(0,l.useMutation)({mutationFn:P,onSuccess:()=>{s.setQueryData("user",(e=>({auth:!1,id:"",balance:0,roles:[],name:"",last_name:"",photo:"",complited_quests:[],operations:[]}))),null===e||void 0===e||e()}})}((()=>{a(!1)})),d=h();return(0,g.jsxs)("div",{className:E.root,children:[(0,g.jsx)(I.rU,{to:"/",className:b(E.home,"material_symbols"),children:"home"}),(0,g.jsxs)("span",{className:E.block,children:[(0,g.jsxs)("div",{className:E.balance,children:[(null===(e=d.data)||void 0===e?void 0:e.balance)||0," G"]}),(0,g.jsx)("button",{className:E.user,onClick:()=>{var e;return null!==(e=d.data)&&void 0!==e&&e.auth?a((e=>!e)):o("/login")},children:(0,g.jsx)("span",{children:null!==(s=d.data)&&void 0!==s&&s.auth?null===(t=d.data)||void 0===t?void 0:t.name:"\u0412\u043e\u0439\u0442\u0438"})}),(null===(i=d.data)||void 0===i?void 0:i.auth)&&(0,g.jsx)("img",{className:E.img,src:d.data.photo,alt:"avatar"}),(0,g.jsxs)("div",{className:b(E.menu,r&&E.menuVisible),children:[(0,g.jsx)("button",{onClick:()=>o("/profile"),children:"\u041f\u0440\u043e\u0444\u0438\u043b\u044c"}),_(d,"page_debug")&&(0,g.jsx)(I.rU,{to:"/debug",children:"</>"}),_(d,"page_worker")&&(0,g.jsx)(I.rU,{to:"/worker",className:"material_symbols",children:"deployed_code"}),(0,g.jsx)("button",{onClick:()=>c.mutate(),disabled:"idle"!=c.status,children:"\u0412\u044b\u0439\u0442\u0438"})]})]}),"loading"==c.status&&(0,g.jsx)(q,{})]})}const O={root:"styles_root__xvR2N",hasFooter:"styles_hasFooter__lMS3o",body:"styles_body__S-p4X",body_centered:"styles_body_centered__NzRPU",body_centeredPage:"styles_body_centeredPage__R-EzO"};function T(e){let{children:s,className:t,styles:n,centered:l=!1,centeredPage:i=!1,height100:r=!1,gap:a=0,header:o,footer:c}=e;return void 0===o&&(o=(0,g.jsx)(F,{})),(0,g.jsxs)("div",{className:b(O.root,!!c&&O.hasFooter),style:{...n,maxHeight:r?"100dvh":""},children:[o||(0,g.jsx)("div",{}),(0,g.jsx)("div",{className:b(O.body,t,l&&O.body_centered,i&&O.body_centeredPage),style:{gap:a,maxHeight:r?"100%":""},children:s}),c]})}function B(){return(0,g.jsx)(T,{centered:!0,header:(0,g.jsx)(C,{}),children:"\u0422\u0430\u043a\u043e\u0439 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u044b \u043d\u0435\u0442"})}function U(){return(0,g.jsx)(T,{centered:!0,header:(0,g.jsx)(C,{}),children:"\u0423 \u0432\u0430\u0441 \u043d\u0435\u0434\u043e\u0441\u0442\u0430\u0442\u0442\u043e\u0447\u043d\u043e \u043f\u0440\u0430\u0432 \u043d\u0430 \u043f\u0440\u043e\u0441\u043c\u043e\u0442\u0440 \u044d\u0442\u043e\u0439 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u044b"})}const z={back:"styles_back__uuJZO",form:"styles_form__n7Rcu"};function D(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"\u041c\u0435\u0440\u043e\u043f\u0440\u0438\u044f\u0442\u0438\u0435";(0,j.useEffect)((()=>{const t=document.title,n="object"!=typeof e?[e]:e;return document.title=[s,...n].filter((e=>!!e)).join(" | "),()=>{document.title=t}}),[e,s])}const W={form:"styles_form__cFFCH",field:"styles_field__5rpBk"};function M(e){let{className:s,style:t,onSubmit:n,children:l}=e;return(0,g.jsx)("form",{className:b(W.form,s),style:t,onSubmit:e=>{e.preventDefault(),n()},children:l})}function R(e){let{label:s,className:t,style:n,children:l}=e;return(0,g.jsxs)("label",{className:b(W.field,t),style:n,children:[(0,g.jsx)("span",{children:s}),l]})}function Y(){D("\u0410\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0438\u044f");const[e,s]=(0,j.useState)(""),t=(0,j.useRef)(null),n=(0,j.useRef)(null),r=function(e){const s=(0,l.useQueryClient)(),t=(0,l.useMutation)({mutationFn:L,onSuccess:e=>{s.setQueryData("user",(()=>e))},onError:s=>{null===e||void 0===e||e(s instanceof i?s.message:"\u041f\u0440\u043e\u0438\u0437\u043e\u0448\u043b\u0430 \u043e\u0448\u0438\u0431\u043a\u0430, \u043f\u043e\u043f\u0440\u043e\u0431\u0443\u0439\u0442\u0435 \u0435\u0449\u0451 \u0440\u0430\u0437")}});return t}(s);return(0,g.jsxs)(T,{header:null,centered:!0,centeredPage:!0,gap:"2em",children:[(0,g.jsx)(I.rU,{to:"/",className:b(z.back,"material_symbols"),children:"arrow_back"}),(0,g.jsx)("h1",{children:"\u041c\u0435\u0440\u043e\u043f\u0440\u0438\u044f\u0442\u0438\u0435"}),e&&(0,g.jsx)("h3",{children:e}),r.isLoading&&(0,g.jsx)(q,{}),(0,g.jsxs)(M,{className:z.form,onSubmit:function(){var e,s;const l=(null===(e=t.current)||void 0===e?void 0:e.value)||"",i=(null===(s=n.current)||void 0===s?void 0:s.value)||"";r.mutate({login:l,password:i})},children:[(0,g.jsx)(R,{label:"\u041b\u043e\u0433\u0438\u043d",children:(0,g.jsx)("input",{ref:t,type:"text",name:"login",required:!0})}),(0,g.jsx)(R,{label:"\u041f\u0430\u0440\u043e\u043b\u044c",children:(0,g.jsx)("input",{ref:n,type:"password",name:"password",required:!0})}),(0,g.jsx)("button",{type:"submit",className:"button button_light button_small",disabled:"loading"==r.status,children:"\u0412\u043e\u0439\u0442\u0438"})]})]})}const G={root:"styles_root__h8xNs",title:"styles_title__+su+v",map:"styles_map__giu5H"},X=t.p+"static/media/map.b7c468d134662b591994.png",J={root:"styles_root__cV7H9"};function V(e){let{curPage:s}=e;return(0,g.jsxs)("div",{className:J.root,children:["map"!=s&&(0,g.jsx)(I.rU,{to:"/",children:"\u041a\u0430\u0440\u0442\u0430"}),"timetable"!=s&&(0,g.jsx)(I.rU,{to:"/timetable",children:"\u0420\u0430\u0441\u043f\u0438\u0441\u0430\u043d\u0438\u0435"}),"quest"!=s&&(0,g.jsx)(I.rU,{to:"/quest",children:"\u041a\u0432\u0435\u0441\u0442\u044b"}),"store"!=s&&(0,g.jsx)(I.rU,{to:"/store",children:"\u041c\u0430\u0433\u0430\u0437\u0438\u043d"})]})}function K(){return(0,g.jsxs)(T,{centeredPage:!0,gap:"1em",className:G.root,footer:(0,g.jsx)(V,{curPage:"map"}),children:[(0,g.jsx)("h1",{className:G.title,children:"Underparty"}),(0,g.jsx)("div",{className:G.map,children:(0,g.jsx)("img",{src:X,alt:"\u041a\u0430\u0440\u0442\u0430"})})]})}const Z={root:"styles_root__7P05R"},$={root:"styles_root__O0923",hidden:"styles_hidden__eYJaf",open:"styles_open__35Vcu",popup:"styles_popup__L-0H0",header:"styles_header__o87wG",close:"styles_close__w0Yhz",body:"styles_body__t75Nd"};function ee(e){let{children:s,open:t=!1,close:n,title:l="",closeOnOutclick:i=!0}=e;const r=(0,j.useRef)(null),[a,o]=(0,j.useState)(t),[c,d]=(0,j.useState)(!t);return(0,j.useEffect)((()=>{if(t){d(!1);const e=setTimeout((()=>o(!0)),100);return()=>clearTimeout(e)}o(!1);const e=setTimeout((()=>d(!0)),250);return()=>clearTimeout(e)}),[t]),(0,g.jsx)("div",{ref:r,className:b($.root,a&&$.open,c&&$.hidden),onClick:e=>{i&&e.target==r.current&&(null===n||void 0===n||n())},children:(0,g.jsxs)("div",{className:$.popup,children:[(l||n)&&(0,g.jsxs)("div",{className:$.header,children:[(0,g.jsx)("h3",{children:l}),n&&(0,g.jsx)("button",{className:$.close,onClick:n})]}),(0,g.jsx)("div",{className:$.body,children:s})]})})}function se(){const[e,s]=(0,j.useState)(""),[t,n]=(0,j.useState)(""),l=(0,j.useRef)(null),i=(0,j.useRef)(null);return(0,g.jsxs)(T,{centered:!0,gap:"1rem",className:Z.root,children:[(0,g.jsx)(I.rU,{to:"/users",children:"Users"}),(0,g.jsx)(I.rU,{to:"/log",children:"Log"}),(0,g.jsx)("button",{onClick:async()=>{s("Loading");try{const e=await fetch("/api/debug/log_errors"),t=await e.text();s(t),setTimeout((()=>{var e,s,t,n;return null===(e=l.current)||void 0===e||null===(s=e.parentElement)||void 0===s?void 0:s.scrollTo(0,null===(t=l.current)||void 0===t||null===(n=t.parentElement)||void 0===n?void 0:n.scrollHeight)}),150)}catch(e){s(JSON.stringify(e))}},children:"Log errors"}),(0,g.jsx)("button",{onClick:async()=>{n("Loading");try{const e=await fetch("/api/debug/log_info"),s=await e.text();n(s),setTimeout((()=>{var e,s,t,n;return null===(e=i.current)||void 0===e||null===(s=e.parentElement)||void 0===s?void 0:s.scrollTo(0,null===(t=i.current)||void 0===t||null===(n=t.parentElement)||void 0===n?void 0:n.scrollHeight)}),150)}catch(e){n(JSON.stringify(e))}},children:"Log requests"}),(0,g.jsx)(ee,{title:"logErrors",open:""!=e,close:()=>s(""),children:(0,g.jsx)("pre",{ref:l,children:e})}),(0,g.jsx)(ee,{title:"log",open:""!=t,close:()=>n(""),children:(0,g.jsx)("pre",{ref:i,children:t})})]})}const te={user:"styles_user__WUZvf",title:"styles_title__Gd1jL",toggle:"styles_toggle__qlIwC",toggleInp:"styles_toggleInp__fGE-7",userInfo:"styles_userInfo__vgBlw",operations:"styles_operations__MGBbv"};function ne(){var e;D("\u041f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0438");const s=(0,l.useQuery)("users",(async()=>await c("/api/users")));return(0,g.jsxs)(T,{centeredPage:!0,gap:8,styles:{fontFamily:"'PT Sans', Arial"},children:[s.isLoading&&(0,g.jsx)("h3",{children:"\u0417\u0430\u0433\u0440\u0443\u0437\u043a\u0430"}),A(s),null===(e=s.data)||void 0===e?void 0:e.map((e=>(0,g.jsxs)("div",{className:te.user,children:[(0,g.jsx)("input",{type:"checkbox",className:te.toggleInp,id:"user".concat(e.id)}),(0,g.jsxs)("label",{className:te.title,htmlFor:"user".concat(e.id),children:[(0,g.jsxs)("div",{children:[(0,g.jsx)("div",{children:e.login}),(0,g.jsx)("div",{style:{color:"blue"},children:e.id}),(0,g.jsx)("div",{children:"|"}),(0,g.jsx)("div",{children:e.name})]}),(0,g.jsxs)("div",{children:[e.deleted&&(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)("div",{style:{color:"tomato"},children:"deleted"}),(0,g.jsx)("div",{children:"|"})]}),(0,g.jsx)("span",{children:e.roles.join(", ")}),(0,g.jsx)("div",{className:te.toggle})]})]}),(0,g.jsx)("div",{className:te.userInfo,children:(0,g.jsxs)("div",{children:[(0,g.jsx)("h4",{children:"Operations"}),(0,g.jsx)("div",{className:te.operations,children:e.operations.map(((e,s)=>(0,g.jsx)("div",{children:le(e)},s)))})]})})]},e.id)))]})}function le(e){const s={page:"#990099",add:"#008000",get:"#008000",change:"#006fb3",delete:"#b30000"};for(const t in s)if(e.startsWith(t))return(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)("span",{style:{color:s[t]},children:t}),(0,g.jsx)("span",{children:e.slice(t.length)})]});return(0,g.jsx)("span",{children:e})}function ie(e){const s=e;return s.date=new Date(e.date),s}function re(e,s){return"".concat(e).padStart(s,"0")}function ae(e){let s=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return function(e){return e?arguments.length>1&&void 0!==arguments[1]&&arguments[1]?"".concat(e.getFullYear(),".").concat(re(e.getMonth()+1,2),".").concat(re(e.getDate(),2)):"".concat(re(e.getDate(),2),".").concat(re(e.getMonth()+1,2),".").concat(e.getFullYear()):""}(e,arguments.length>2&&void 0!==arguments[2]&&arguments[2])+" "+function(e){let s=arguments.length>1&&void 0!==arguments[1]&&arguments[1],t="".concat(re(e.getHours(),2),":").concat(re(e.getMinutes(),2));return s?t+":".concat(re(e.getSeconds(),2)):t}(e,s)}const oe={table:"styles_table__QLr-h",changesCell:"styles_changesCell__0wQDJ",changes:"styles_changes__EyS9f",btn:"styles_btn__H7b72"};function ce(){var e;D("Log");const s=(0,l.useQuery)("log",(async()=>(await c("/api/debug/log")).map(ie)));return(0,g.jsxs)(T,{centeredPage:!0,styles:{fontFamily:"'PT Sans', Arial"},children:[s.isFetching&&(0,g.jsx)("h3",{children:"\u0417\u0430\u0433\u0440\u0443\u0437\u043a\u0430"}),A(s),!s.isFetching&&(0,g.jsx)("button",{className:oe.btn,onClick:()=>s.refetch(),children:"Update"}),(0,g.jsxs)("table",{className:oe.table,children:[(0,g.jsx)("thead",{children:(0,g.jsxs)("tr",{children:[(0,g.jsx)("th",{style:{minWidth:"9.5em"},children:"Date"}),(0,g.jsx)("th",{style:{minWidth:"4em"},children:"Action"}),(0,g.jsx)("th",{style:{minWidth:"9.5em"},children:"Table[id]"}),(0,g.jsx)("th",{children:"User[id]"}),(0,g.jsx)("th",{style:{width:"18em"},children:"Changes"})]})}),(0,g.jsx)("tbody",{children:null===(e=s.data)||void 0===e?void 0:e.map((e=>(0,g.jsxs)("tr",{children:[(0,g.jsx)("td",{children:ae(e.date,!0,!0)}),(0,g.jsx)("td",{children:de(e.actionCode)}),(0,g.jsxs)("td",{children:[e.tableName,"[",e.recordId,"]"]}),(0,g.jsxs)("td",{children:[e.userName," [",e.userId,"]"]}),(0,g.jsx)("td",{className:oe.changesCell,children:(0,g.jsxs)("div",{className:oe.changes,children:[(0,g.jsx)("input",{type:"checkbox",className:oe.toggleInp,id:"item".concat(e.id)}),(0,g.jsx)("div",{children:e.changes.map((e=>(0,g.jsxs)("div",{children:[e[0],": ",JSON.stringify(e[1])," ","->"," ",JSON.stringify(e[2])]},e[0])))}),e.changes.length>0&&(0,g.jsx)("label",{className:oe.btn,htmlFor:"item".concat(e.id),children:e.changes.length})]})})]},e.id)))})]})]})}function de(e){return(0,g.jsx)("span",{style:{color:{added:"#008000",deleted:"#b30000",updated:"#006fb3",restored:"#990099"}[e]},children:e})}const ue={back:"styles_back__Qx6+G",auth:"styles_auth__p4qSS",login:"styles_login__HG64A"},he="data:image/png;base64,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";function me(){return D("\u0410\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0438\u044f"),(0,g.jsxs)(T,{header:null,centered:!0,centeredPage:!0,gap:"2em",children:[(0,g.jsx)(I.rU,{to:"/",className:b(ue.back,"material_symbols"),children:"arrow_back"}),(0,g.jsx)(I.rU,{to:"/auth",className:ue.auth}),(0,g.jsx)("h1",{children:"Underparty"}),(0,g.jsxs)("a",{className:ue.login,href:"https://oauth.vk.com/authorize?client_id=51843506&redirect_uri=https://platformevent.pythonanywhere.com/auth_vk&display=page&response_type=code",children:[(0,g.jsx)("span",{children:"\u0412\u043e\u0439\u0442\u0438 \u0447\u0435\u0440\u0435\u0437"}),(0,g.jsx)("img",{src:he,alt:"VK"})]})]})}const _e={root:"styles_root__Rm-tG",input:"styles_input__2tNlg",password:"styles_password__Om-1z",img:"styles_img__SrXRK"};function xe(){var e,s,t,n;const i=h(),r=(0,j.useRef)(null),[o,c]=(0,j.useState)(!1),d=function(e){const s=(0,l.useQueryClient)();return(0,l.useMutation)({mutationFn:async e=>(await a("/api/user/change_name",e),e),onSuccess:t=>{var n;"success"==(null===(n=s.getQueryState("user"))||void 0===n?void 0:n.status)&&s.setQueryData("user",(e=>({...e,name:t.name}))),null===e||void 0===e||e()}})}();return(0,g.jsx)(T,{centered:!0,gap:"1rem",children:(0,g.jsxs)("div",{className:_e.root,children:[A(d),d.isLoading&&(0,g.jsx)(q,{}),(0,g.jsxs)("div",{children:[(0,g.jsx)("img",{className:_e.img,src:null===(e=i.data)||void 0===e?void 0:e.photo,alt:"avatar"}),(0,g.jsx)("h3",{children:"\u0418\u043c\u044f"}),(0,g.jsx)("div",{children:(0,g.jsx)("input",{type:"text",ref:r,defaultValue:null===(s=i.data)||void 0===s?void 0:s.name,disabled:!o,className:_e.input})}),(0,g.jsxs)("div",{children:[!o&&(0,g.jsx)("button",{onClick:()=>c(!0),className:"button button_small",children:"\u0418\u0437\u043c\u0435\u043d\u0438\u0442\u044c"}),o&&(0,g.jsx)("button",{onClick:()=>{var e;c(!1),r.current&&(r.current.value=(null===(e=i.data)||void 0===e?void 0:e.name)||"")},className:"button button_small",children:"\u041e\u0442\u043c\u0435\u043d\u0430"}),o&&(0,g.jsx)("button",{onClick:()=>{c(!1),r.current&&d.mutate({name:r.current.value})},className:"button button_small",children:"\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c"})]})]}),(0,g.jsxs)("div",{children:[(0,g.jsx)("h3",{children:"\u0424\u0430\u043c\u0438\u043b\u0438\u044f"}),null===(t=i.data)||void 0===t?void 0:t.last_name]}),(0,g.jsxs)("div",{children:[(0,g.jsx)("h3",{children:"\u0420\u043e\u043b\u0438"}),null===(n=i.data)||void 0===n?void 0:n.roles.map(((e,s)=>(0,g.jsx)("div",{children:e},s)))]})]})})}const fe={root:"styles_root__E5y+5",title:"styles_title__3QqY9",map:"styles_map__bsZaz"},je=t.p+"static/media/timetable.9dbcb4664b2137d4198b.png";function ve(){return(0,g.jsxs)(T,{centeredPage:!0,gap:"1em",className:fe.root,footer:(0,g.jsx)(V,{curPage:"timetable"}),children:[(0,g.jsx)("h1",{className:fe.title,children:"Underparty"}),(0,g.jsx)("div",{className:fe.map,children:(0,g.jsx)("img",{src:je,alt:"\u0420\u0430\u0441\u043f\u0438\u0441\u0430\u043d\u0438\u0435"})})]})}function ge(){return(0,l.useQuery)("quests",(async()=>await c("/api/quests")))}function pe(e,s){return(0,l.useMutation)({mutationFn:async e=>await d("/api/quest_complete",e),onSuccess:e,onError:s})}const Ae={root:"styles_root__CEdGL",body:"styles_body__o-6ZK",bottom:"styles_bottom__zkZn6",title:"styles_title__6wHPv",btnQr:"styles_btnQr__94tox",quests:"styles_quests__58NxQ",quest:"styles_quest__65tbN"};var ye=t(741);function be(e){let{code:s,scale:t=10,margin:n=1,color:l="#000000",colorBg:i="#ffffff"}=e;const[r,a]=(0,j.useState)("");return(0,j.useEffect)((()=>{s&&(a(""),ye.toDataURL(s,{errorCorrectionLevel:"H",scale:t,margin:n,color:{dark:l,light:i}},((e,s)=>a(s))))}),[s,l,t,n,i]),(0,g.jsx)("img",{src:r,alt:s,style:{width:"100%"}})}function He(){var e,s;const t=h(),n=u(),[l,i]=(0,j.useState)(!1),r=ge();return(0,g.jsxs)(T,{centeredPage:!0,gap:"1em",className:Ae.root,footer:(0,g.jsx)(V,{curPage:"quest"}),children:[r.isLoading&&(0,g.jsx)(q,{}),t.isFetching&&(0,g.jsx)(q,{}),(0,g.jsxs)("div",{className:Ae.body,children:[(0,g.jsx)("h1",{className:Ae.title,children:"Underparty"}),(0,g.jsxs)("div",{className:Ae.quests,children:[A(r),null===r||void 0===r||null===(e=r.data)||void 0===e?void 0:e.map((e=>{var s;return(0,g.jsxs)("div",{className:Ae.quest,children:[(0,g.jsx)("span",{children:e.name}),null!==(s=t.data)&&void 0!==s&&s.complited_quests.includes(e.id)?(0,g.jsx)("span",{className:"material_symbols",children:"done"}):(0,g.jsxs)("span",{children:[e.reward,"G"]})]},e.id)}))]})]}),(0,g.jsx)("div",{className:Ae.bottom,children:(0,g.jsx)("button",{className:Ae.btnQr,onClick:()=>i(!0),children:"\u0417\u0430\u0432\u0435\u0440\u0448\u0438\u0442\u044c \u043a\u0432\u0435\u0441\u0442!"})}),(0,g.jsx)(ee,{title:"\u0417\u0430\u0432\u0435\u0440\u0448\u0435\u043d\u0438\u0435 \u043a\u0432\u0435\u0441\u0442\u0430",open:l,close:()=>{var e;i(!1),null!==(e=t.data)&&void 0!==e&&e.auth&&n()},children:null!==t&&void 0!==t&&null!==(s=t.data)&&void 0!==s&&s.auth?(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)(be,{code:"user_".concat(t.data.id),colorBg:"#ffffff00",scale:13}),(0,g.jsx)("h3",{children:"\u041f\u043e\u043a\u0430\u0436\u0438\u0442\u0435 qr-\u043a\u043e\u0434 \u043a\u0432\u0435\u0441\u0442\u043e\u0432\u0438\u043a\u0443"})]}):(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)("p",{children:"\u0414\u043b\u044f \u043f\u0440\u043e\u0445\u043e\u0436\u0434\u0435\u043d\u0438\u044f \u043a\u0432\u0435\u0441\u0442\u043e\u0432 \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e \u0432\u043e\u0439\u0442\u0438 \u0432 \u0441\u0438\u0441\u0442\u0435\u043c\u0443."}),(0,g.jsx)("p",{children:"\u041a\u043d\u043e\u043f\u043a\u0430 \u0432\u0445\u043e\u0434\u0430 \u043d\u0430\u0445\u043e\u0434\u0438\u0442\u044c\u0441\u044f \u0432 \u043f\u0440\u0430\u0432\u043e\u043c \u0432\u0435\u0440\u0445\u043d\u0435\u043c \u0443\u0433\u043b\u0443."})]})})]})}function Ne(e,s){return(0,l.useMutation)({mutationFn:async e=>await d("/api/store_sell_check",e),onSuccess:(s,t)=>{s.itemId=t.itemId,s.visitorId=t.userId,null===e||void 0===e||e(s)},onError:s})}const we={root:"styles_root__0CejE",title:"styles_title__u3Xt9",items:"styles_items__n-Fvc",item:"styles_item__zIxt2",item__img:"styles_item__img__r3iEr",item__desc:"styles_item__desc__wbcAM"};function ke(){var e,s,t;const n=h(),i=u(),[r,a]=(0,j.useState)(!1),[o,d]=(0,j.useState)(null),m=(0,l.useQuery)("storeItems",(async()=>await c("/api/store_items")));return(0,g.jsxs)(T,{centeredPage:!0,gap:"1em",className:we.root,footer:(0,g.jsx)(V,{curPage:"store"}),children:[m.isLoading&&(0,g.jsx)(q,{}),(0,g.jsx)("h1",{className:we.title,children:"Underparty"}),(0,g.jsxs)("div",{className:we.items,children:[A(m),null===m||void 0===m||null===(e=m.data)||void 0===e?void 0:e.map((e=>(0,g.jsxs)("button",{className:we.item,onClick:()=>{d(e),a(!0)},children:[(0,g.jsx)("div",{className:we.item__img,children:(0,g.jsx)("img",{src:e.img,alt:"\u0422\u043e\u0432\u0430\u0440"})}),(0,g.jsxs)("div",{className:we.item__desc,children:[(0,g.jsx)("span",{children:e.name}),(0,g.jsxs)("span",{children:[e.price," G"]})]})]},e.id)))]}),(0,g.jsx)(ee,{title:"\u041f\u043e\u043a\u0443\u043f\u043a\u0430 \u0442\u043e\u0432\u0430\u0440\u0430",open:r,close:()=>{var e;a(!1),null===(e=n.data)||void 0===e||!e.auth||n.data.balance<((null===o||void 0===o?void 0:o.price)||0)||i()},children:null!==n&&void 0!==n&&null!==(s=n.data)&&void 0!==s&&s.auth?(0,g.jsx)(g.Fragment,{children:n.data.balance<((null===o||void 0===o?void 0:o.price)||0)?(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)("h2",{style:{marginBottom:8},children:"\u041a \u0441\u043e\u0436\u0430\u043b\u0435\u043d\u0438\u044e, \u044d\u0442\u043e\u0442 \u0442\u043e\u0432\u0430\u0440 \u0432\u0430\u043c \u043d\u0435 \u043f\u043e \u043a\u0430\u0440\u043c\u0430\u043d\u0443"}),(0,g.jsxs)("h2",{className:we.item__desc,children:[(0,g.jsx)("span",{children:null===o||void 0===o?void 0:o.name}),(0,g.jsxs)("span",{children:[null===o||void 0===o?void 0:o.price," G"]})]}),(0,g.jsxs)("h2",{className:we.item__desc,style:{marginBottom:8},children:[(0,g.jsx)("span",{children:"\u0412\u0430\u043c \u043d\u0435 \u0445\u0432\u0430\u0442\u0430\u0435\u0442:"}),(0,g.jsxs)("span",{children:[((null===o||void 0===o?void 0:o.price)||0)-n.data.balance," G"]})]}),(0,g.jsx)("h3",{children:"\u0412\u044b\u043f\u043e\u043b\u043d\u044f\u0439\u0442\u0435 \u043a\u0432\u0435\u0441\u0442\u044b \u0438 \u0440\u0430\u0437\u0431\u043e\u0433\u0430\u0442\u0435\u0435\u0442\u0435!"})]}):(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)(be,{code:"user_".concat(null===(t=n.data)||void 0===t?void 0:t.id,";item_").concat(null===o||void 0===o?void 0:o.id),colorBg:"#ffffff00",scale:13}),(0,g.jsxs)("h2",{className:we.item__desc,children:[(0,g.jsx)("span",{children:null===o||void 0===o?void 0:o.name}),(0,g.jsxs)("span",{children:[null===o||void 0===o?void 0:o.price," G"]})]}),(0,g.jsx)("h3",{children:"\u041f\u043e\u043a\u0430\u0436\u0438\u0442\u0435 qr-\u043a\u043e\u0434 \u043f\u0440\u043e\u0434\u0430\u0432\u0446\u0443"}),(0,g.jsx)("h4",{children:"\u0415\u0441\u043b\u0438 \u0431\u0430\u043b\u0430\u043d\u0441 \u043d\u0435 \u043e\u0431\u043d\u043e\u0432\u0438\u043b\u0441\u044f \u0447\u0435\u0440\u0435\u0437 \u043f\u0430\u0440\u0443 \u0441\u0435\u043a\u0443\u043d\u0434 - \u043f\u0435\u0440\u0435\u0437\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u0435 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u0443"})]})}):(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)("p",{children:"\u0414\u043b\u044f \u0441\u043e\u0432\u0435\u0440\u0448\u0435\u043d\u0438\u044f \u043f\u043e\u043a\u0443\u043f\u043e\u043a \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e \u0432\u043e\u0439\u0442\u0438 \u0432 \u0441\u0438\u0441\u0442\u0435\u043c\u0443."}),(0,g.jsx)("p",{children:"\u041a\u043d\u043e\u043f\u043a\u0430 \u0432\u0445\u043e\u0434\u0430 \u043d\u0430\u0445\u043e\u0434\u0438\u0442\u044c\u0441\u044f \u0432 \u043f\u0440\u0430\u0432\u043e\u043c \u0432\u0435\u0440\u0445\u043d\u0435\u043c \u0443\u0433\u043b\u0443."})]})})]})}const Se={root:"styles_root__91Sa8",title:"styles_title__Duk4+"},Ce={root:"styles_root__QdJnV",msg:"styles_msg__plnAU",msg_visible:"styles_msg_visible__G0rDm",msg_dimmed:"styles_msg_dimmed__0Xs60",bar:"styles_bar__VuYbs",bar_full:"styles_bar_full__poY0b"},Ie={error:"styles_error__EtK3I",video:"styles_video__b88Zl"},Ee=t.p+"static/media/beep.38f199e084efe5461ffd.mp3";var Le=t(1096);let Pe=e=>{},Qe=()=>{},qe=!1,Fe=null,Oe=null;function Te(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500;if(!Oe){Fe=document.createElement("div"),document.body.appendChild(Fe),Fe.style.display="flex",Fe.style.backgroundColor="black";const e=document.createElement("video");Fe.appendChild(e),Oe=new Le.Z(e,(e=>Pe(e.data)),{highlightScanRegion:!0,maxScansPerSecond:10})}(0,j.useEffect)((()=>(setTimeout((()=>{var e;return null===(e=Oe)||void 0===e?void 0:e.start().catch((()=>{setTimeout((()=>{var e;null===(e=Oe)||void 0===e||e.start().catch((()=>Qe()))}),250)}))}),100),()=>{var e;null===(e=Oe)||void 0===e||e.stop()})),[]);const[t,n]=(0,j.useState)(!1),[l,i]=(0,j.useState)(""),[r,a]=(0,j.useState)(qe),o=function(e){const[s]=(0,j.useState)((()=>{const s=new Audio(e);return s.preload="auto",s}));return()=>{s.currentTime=0,s.play()}}(Ee);return Pe=l=>{t||e||(i(l),n(!0),o(),setTimeout((()=>{i(""),n(!1)}),s))},Qe=()=>{qe=!0,a(!0)},r?{scanned:l,scanner:(0,g.jsxs)("div",{className:Ie.error,children:[(0,g.jsx)("h1",{children:"\u041d\u0435\u0442 \u0434\u043e\u0441\u0442\u0443\u043f\u0430 \u043a \u043a\u0430\u043c\u0435\u0440\u0435"}),(0,g.jsx)("p",{children:"\u0420\u0430\u0437\u0440\u0435\u0448\u0438\u0442\u0435 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u0435 \u043a\u0430\u043c\u0435\u0440\u044b \u044d\u0442\u043e\u043c\u0443 \u0441\u0430\u0439\u0442\u0443 \u0438 \u0431\u0440\u0430\u0443\u0437\u0435\u0440\u0443, \u043a\u043e\u0442\u043e\u0440\u044b\u0439 \u0432\u044b \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0442\u0435."}),(0,g.jsx)("p",{children:"\u041f\u043e\u0441\u043b\u0435 \u043f\u0435\u0440\u0435\u0437\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u0435 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u0443."})]})}:{scanned:l,scanner:(0,g.jsx)("div",{children:(0,g.jsx)("div",{ref:e=>{e&&(e.innerHTML="",e.appendChild(Fe))},className:Ie.video})})}}function Be(e){let{useMutation:s,onScan:t,formatMsg:n,onRes:l,className:i,pause:r}=e;const[a,o]=(0,j.useState)(""),[c,d]=(0,j.useState)(""),u=(0,j.useRef)(null),h=s((e=>{o(n(e)),d(""),x(),null===l||void 0===l||l(e)}),(e=>{o(""),d(p(e)),x()})),{scanned:m,scanner:_}=Te(!h.isIdle||r);function x(){var e;setTimeout((()=>h.reset()),1e3),null===(e=u.current)||void 0===e||e.classList.add(Ce.bar_full),setTimeout((()=>{var e;return null===(e=u.current)||void 0===e?void 0:e.classList.remove(Ce.bar_full)}),100)}return(0,j.useEffect)((()=>{if(""==m||!h.isIdle)return;o(""),d("");const e=t(m);e?h.mutate(e):d("\u041d\u0435 \u043e\u043f\u043e\u0437\u043d\u0430\u043d\u043e")}),[m]),(0,g.jsxs)("div",{className:b(Ce.root,i),children:[h.isLoading&&(0,g.jsx)(q,{}),_,(0,g.jsxs)("div",{className:b(Ce.msg,(a||c)&&Ce.msg_visible,(a||c)&&h.isIdle&&Ce.msg_dimmed),children:[(0,g.jsx)("h2",{children:a}),(0,g.jsx)("h2",{children:c})]}),(0,g.jsx)("div",{ref:u,className:Ce.bar})]})}function Ue(){var e,s;const t=(0,n.UO)(),l=parseInt(t.questId,10),i=ge();return(0,g.jsxs)(T,{className:Se.root,children:[i.isLoading&&(0,g.jsx)(q,{}),(0,g.jsxs)("div",{className:Se.title,children:[(0,g.jsx)("h2",{children:null===(e=i.data)||void 0===e||null===(s=e.find((e=>e.id==l)))||void 0===s?void 0:s.name}),(0,g.jsx)("h3",{children:"\u041f\u0440\u043e\u0441\u043a\u0430\u043d\u0438\u0440\u0443\u0439\u0442\u0435 qr-\u043a\u043e\u0434 \u043f\u043e\u0441\u0435\u0442\u0438\u0442\u0435\u043b\u044f, \u0447\u0442\u043e\u0431\u044b \u0437\u0430\u0441\u0447\u0438\u0442\u0430\u0442\u044c \u0435\u043c\u0443 \u044d\u0442\u043e\u0442 \u043a\u0432\u0435\u0441\u0442."}),A(i)]}),(0,g.jsx)(Be,{useMutation:pe,onScan:e=>{if(!e.startsWith("user_"))return null;return{userId:e.slice(5),questId:l}},formatMsg:e=>({ok:"\u041a\u0432\u0435\u0441\u0442 \u0437\u0430\u0447\u0442\u0451\u043d \u0434\u043b\u044f ".concat(e.visitor),already_done:"".concat(e.visitor," \u0443\u0436\u0435 \u043f\u0440\u043e\u0445\u043e\u0434\u0438\u043b \u044d\u0442\u043e\u0442 \u043a\u0432\u0435\u0441\u0442"),no_visitor:"\u041f\u043e\u0441\u0435\u0442\u0438\u0442\u0435\u043b\u044c \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d"}[e.res]||e.res)})]})}const ze={btn:"styles_btn__w12Ul"};function De(){return(0,g.jsxs)(T,{centered:!0,gap:"0.5rem",children:[x("page_scanner_quest")&&(0,g.jsx)(I.rU,{to:"/scanner_quest",className:ze.btn,children:"\u0414\u043b\u044f \u043a\u0432\u0435\u0441\u0442\u043e\u0432\u0438\u043a\u043e\u0432"}),x("page_scanner_store")&&(0,g.jsx)(I.rU,{to:"/scanner_store",className:ze.btn,children:"\u0414\u043b\u044f \u043f\u0440\u043e\u0434\u0430\u0432\u0446\u043e\u0432"})]})}const We={root:"styles_root__d985G",quests:"styles_quests__TBzNh"};function Me(){var e;const s=ge();return(0,g.jsxs)(T,{centered:!0,gap:"1rem",className:We.root,children:[s.isLoading&&(0,g.jsx)(q,{}),A(s),(0,g.jsx)("h2",{children:"\u041a\u0430\u043a\u043e\u0439 \u043a\u0432\u0435\u0441\u0442 \u0432\u044b \u043f\u0440\u043e\u0432\u043e\u0434\u0438\u0442\u0435?"}),(0,g.jsx)("div",{className:We.quests,children:null===(e=s.data)||void 0===e?void 0:e.map((e=>(0,g.jsx)(I.rU,{to:"/scanner_quest/"+e.id,children:e.name},e.id)))})]})}const Re={root:"styles_root__jLTkZ",title:"styles_title__oIrEy",item:"styles_item__rXv3s",item__img:"styles_item__img__O-P1T",item__desc:"styles_item__desc__zxJ9K",btns:"styles_btns__9aQ2N",btn_deny:"styles_btn_deny__7EPCy",btn_ok:"styles_btn_ok__WFDzm"};function Ye(){const[e,s]=(0,j.useState)(!1),[t,n]=(0,j.useState)(!1),[i,r]=(0,j.useState)(null),a=function(e,s){return(0,l.useMutation)({mutationFn:async e=>await d("/api/store_sell",e),onSuccess:e,onError:s})}(c,c);function o(){s(!1),n(!1)}function c(){n(!1)}return(0,g.jsxs)(T,{className:Re.root,children:[a.isLoading&&(0,g.jsx)(q,{}),(0,g.jsx)("div",{className:Re.title,children:(0,g.jsx)("h3",{children:"\u041f\u0440\u043e\u0441\u043a\u0430\u043d\u0438\u0440\u0443\u0439\u0442\u0435 qr-\u043a\u043e\u0434 \u043f\u043e\u0441\u0435\u0442\u0438\u0442\u0435\u043b\u044f, \u0447\u0442\u043e\u0431\u044b \u043f\u0440\u043e\u0434\u0430\u0442\u044c \u0435\u043c\u0443 \u0442\u043e\u0432\u0430\u0440."})}),(0,g.jsx)(Be,{useMutation:Ne,pause:e,onScan:e=>{const s=e.split(";");if(2!=s.length)return null;const[t,n]=s;if(!t.startsWith("user_")||!n.startsWith("item_"))return null;const l=t.slice(5),i=parseInt(n.slice(5),10);return isNaN(i)?null:{userId:l,itemId:i}},formatMsg:e=>{var s;return null!==(s={ok:"",no_item:"\u0422\u043e\u0432\u0430\u0440 \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d",no_visitor:"\u041f\u043e\u043a\u0443\u043f\u0430\u0442\u0435\u043b\u044c \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d",no_money:"\u0423 ".concat(e.visitor," \u043d\u0435 \u0445\u0432\u0430\u0442\u0430\u0435\u0442 \u0441\u0440\u0435\u0434\u0441\u0442\u0432")}[e.res])&&void 0!==s?s:e.res},onRes:e=>{"ok"==e.res&&(s(!0),n(!0),r(e))}}),(0,g.jsxs)(ee,{title:"\u041f\u0440\u043e\u0434\u0430\u0436\u0430 \u0442\u043e\u0432\u0430\u0440\u0430",open:t,closeOnOutclick:!1,close:o,children:[(0,g.jsxs)("h3",{children:[null===i||void 0===i?void 0:i.visitor," \u0445\u043e\u0447\u0435\u0442 \u043a\u0443\u043f\u0438\u0442\u044c:"]}),(0,g.jsxs)("div",{className:Re.item,children:[(0,g.jsx)("div",{className:Re.item__img,children:(0,g.jsx)("img",{src:null===i||void 0===i?void 0:i.item.img,alt:"\u0422\u043e\u0432\u0430\u0440"})}),(0,g.jsxs)("div",{className:Re.item__desc,children:[(0,g.jsx)("span",{children:null===i||void 0===i?void 0:i.item.name}),(0,g.jsxs)("span",{children:[null===i||void 0===i?void 0:i.item.price," G"]})]})]}),(0,g.jsx)("p",{children:"\u0412\u044b\u0434\u0430\u0439\u0442\u0435 \u0442\u043e\u0432\u0430\u0440 \u0438 \u043f\u043e\u0434\u0442\u0432\u0435\u0440\u0434\u0438\u0442\u0435 \u043f\u043e\u043a\u0443\u043f\u043a\u0443:"}),(0,g.jsxs)("div",{className:Re.btns,children:[(0,g.jsx)("button",{className:Re.btn_deny,onClick:o,children:"\u041e\u0442\u043a\u043b\u043e\u043d\u0438\u0442\u044c"}),(0,g.jsx)("button",{className:Re.btn_ok,onClick:()=>{a.mutate({userId:i.visitorId,itemId:i.itemId})},children:"\u041f\u043e\u0434\u0442\u0432\u0435\u0440\u0434\u0438\u0442\u044c"})]})]}),(0,g.jsxs)(ee,{title:"\u041f\u0440\u043e\u0434\u0430\u0436\u0430 \u0442\u043e\u0432\u0430\u0440\u0430",open:a.isSuccess||a.isError,close:function(){a.reset(),s(!1)},children:[a.isSuccess&&("ok"==a.data.res?(0,g.jsxs)("h2",{children:["\u0422\u043e\u0432\u0430\u0440 ",a.data.item," \u0443\u0441\u043f\u0435\u0448\u043d\u043e \u043f\u0440\u043e\u0434\u0430\u043d \u043f\u043e\u0441\u0435\u0442\u0438\u0442\u0435\u043b\u044e ",a.data.visitor]}):(0,g.jsxs)("h2",{children:["\u0423 ",a.data.visitor," \u043d\u0435 \u0445\u0432\u0430\u0442\u0430\u0435\u0442 \u0441\u0440\u0435\u0434\u0441\u0442\u0432 \u043d\u0430 \u043f\u043e\u043a\u0443\u043f\u043a\u0443 ",a.data.item]})),A(a)]})]})}function Ge(){var e,s;const t=h();function l(e,s,l){var i;return(0,g.jsx)(n.AW,{path:s,element:null!==(i=t.data)&&void 0!==i&&i.auth?null==e||_(t,e)?l:(0,g.jsx)(U,{}):(0,g.jsx)(n.Fg,{to:"/auth"})})}return(0,g.jsxs)("div",{className:"root",children:[(0,g.jsx)(v,{}),(0,g.jsx)(w,{}),t.isLoading&&(0,g.jsx)(f.Z,{}),A(t),t.isSuccess&&(0,g.jsxs)(n.Z5,{children:[(0,g.jsx)(n.AW,{path:"/",element:(0,g.jsx)(K,{})}),(0,g.jsx)(n.AW,{path:"/login",element:null!==(e=t.data)&&void 0!==e&&e.auth?(0,g.jsx)(n.Fg,{to:"/"}):(0,g.jsx)(me,{})}),(0,g.jsx)(n.AW,{path:"/auth",element:null!==(s=t.data)&&void 0!==s&&s.auth?(0,g.jsx)(n.Fg,{to:"/"}):(0,g.jsx)(Y,{})}),(0,g.jsx)(n.AW,{path:"/timetable",element:(0,g.jsx)(ve,{})}),(0,g.jsx)(n.AW,{path:"/quest",element:(0,g.jsx)(He,{})}),(0,g.jsx)(n.AW,{path:"/store",element:(0,g.jsx)(ke,{})}),l(null,"/profile",(0,g.jsx)(xe,{})),l("page_worker","/worker",(0,g.jsx)(De,{})),l("page_scanner_quest","/scanner_quest",(0,g.jsx)(Me,{})),l("page_scanner_quest","/scanner_quest/:questId",(0,g.jsx)(Ue,{})),l("page_scanner_store","/scanner_store",(0,g.jsx)(Ye,{})),l("page_debug","/debug",(0,g.jsx)(se,{})),l("page_debug","/log",(0,g.jsx)(ce,{})),l("page_users","/users",(0,g.jsx)(ne,{})),(0,g.jsx)(n.AW,{path:"*",element:(0,g.jsx)(B,{})})]})]})}}}]);
//# sourceMappingURL=303.cc3c10c0.chunk.js.map